var te=Object.defineProperty,ne=Object.defineProperties;var oe=Object.getOwnPropertyDescriptors;var V=Object.getOwnPropertySymbols;var re=Object.prototype.hasOwnProperty,se=Object.prototype.propertyIsEnumerable;var O=(e,t,n)=>t in e?te(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,j=(e,t)=>{for(var n in t||(t={}))re.call(t,n)&&O(e,n,t[n]);if(V)for(var n of V(t))se.call(t,n)&&O(e,n,t[n]);return e},I=(e,t)=>ne(e,oe(t));var v=(e,t,n)=>(O(e,typeof t!="symbol"?t+"":t,n),n);import{c as s,a as k,R as $,d as g,r as b,o as ue,G as ie,b as B,w as H,S as ae,e as T,E as le,f as ce,u as de,g as me,i as he,h as fe,p as R,j as pe,v as xe,T as ve,k as ge,n as z,l as X,m as be}from"./vendor.48ed32e2.js";const we=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const u of r)if(u.type==="childList")for(const c of u.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function n(r){const u={};return r.integrity&&(u.integrity=r.integrity),r.referrerpolicy&&(u.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?u.credentials="include":r.crossorigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function o(r){if(r.ep)return;r.ep=!0;const u=n(r);fetch(r.href,u)}};we();class M{constructor(t){v(this,"parent");v(this,"children");v(this,"attrs");this.parent=t.parent,this.attrs=t.attrs,t.children&&(this.children=t.children)}}class ye{constructor(t){v(this,"records",[]);v(this,"index",0);v(this,"max");v(this,"recording");var n,o;this.max=(n=t==null?void 0:t.max)!=null?n:20,this.recording=(o=t==null?void 0:t.recording)!=null?o:!0}}class Ce{constructor(t){v(this,"type");v(this,"canvas");v(this,"record");v(this,"selected",[]);v(this,"graph");this.type="PcForm",this.record=new ye,this.canvas=new M({parent:void 0,children:[],attrs:t.attrs})}setGraph(t){this.graph=t}}const Se=[{title:"undo",icon:s("span",null,[k("undo")]),click:e=>{var t;return console.log("undo",(t=e.graph)==null?void 0:t.undo())}},{title:"redo",icon:s("span",null,[k("redo")]),click:e=>{var t;return console.log("redo",(t=e.graph)==null?void 0:t.redo())}}],Be=[{title:"Button",icon:s("span",null,[k("Button")])},{title:"Container",icon:s("span",null,[k("container")])}];var w;(function(e){e[e.Canvas=0]="Canvas",e[e.Button=1]="Button",e[e.Container=2]="Container"})(w||(w={}));const ke=()=>{var r;const e=new M({parent:void 0,children:[],attrs:{type:w.Canvas,id:"1",name:"mock pc form",width:800,height:600,offsetX:0,offsetY:0}}),t=new M({parent:e,attrs:{id:"2",type:w.Button,name:"mock button 1",width:80,height:40,offsetX:200,offsetY:100}}),n=new M({parent:e,attrs:{type:w.Button,id:"3",name:"mock button 2",width:80,height:40,offsetX:150,offsetY:200}}),o=new M({parent:e,attrs:{type:w.Container,id:"4",name:"mock container",width:400,height:200,offsetX:50,offsetY:300}});return(r=e.children)==null||r.push(t,n,o),e};function _e(e){const t=Object.assign({id:e.attrs.id,x:e.attrs.offsetX,y:e.attrs.offsetY,width:e.attrs.width,height:e.attrs.height},{data:e.attrs});switch(e.attrs.type){case w.Button:return new $(I(j({},t),{attrs:{rect:{fill:"#31D0C6",stroke:"#4B4A67",strokeWidth:1},text:{text:w[e.attrs.type],fill:"white"}}}));case w.Container:return new $(I(j({},t),{attrs:{rect:{fill:"#31D0C6",stroke:"#4B4A67",strokeWidth:1}}}));default:throw new Error(`[Sa error]: unexpected element type ${e.attrs.type}.`)}}function Pe(e){const t=e.cells,n=D(t[0]);let o=n.position.x,r=n.position.x+n.size.width,u=n.position.y,c=n.position.y+n.size.height;return t.forEach(f=>{const i=D(f);i.position.x<o&&(o=i.position.x),r<i.position.x+i.size.width&&(r=i.position.x+i.size.width),i.position.y<u&&(u=i.position.y),c<i.position.y+i.size.height&&(c=i.position.y+i.size.height)}),{x:o,y:u,width:r-o,height:c-u}}function D(e){return{position:e.getProp("position"),size:e.getProp("size")}}var Me=g({name:"SaPcFormRender",props:{drawer:{required:!0,type:Object}},setup(e){const t=b(null);return ue(()=>{var n;if(t.value){const o=ke();console.log("create graph",o);const r=new ie({container:t.value,autoResize:!0,history:!0,width:o.attrs.width,height:o.attrs.height,snapline:!0,grid:{visible:!0,type:"doubleMesh",args:[{color:"#eee",thickness:1},{color:"#ddd",thickness:1,factor:4}]},selecting:{enabled:!0,multiple:!0,rubberband:!0,movable:!0,showEdgeSelectionBox:!0},rotating:{enabled:!0,grid:15},resizing:!0,translating:{restrict(c){var i;const f=c.cell;if(f.isNode()){const y=f.getParent();if(y){const m=y.getBBox(),h=c.graph.selection;if((i=h==null?void 0:h.cells)==null?void 0:i.length){const C=Pe(h),S=D(f);return{x:m.x+S.position.x-C.x,y:m.y+S.position.y-C.y,width:m.width-(C.width-S.size.width),height:m.height-(C.height-S.size.height)}}return m}}return{x:0,y:0,width:o.attrs.width,height:o.attrs.height}}},clipboard:{enabled:!0,useLocalStorage:!0},embedding:{enabled:!0,frontOnly:!1,findParent({node:c,view:f}){const i=c.getBBox();return this.getNodes().filter(y=>{const m=y.getData();if(m&&m.type===w.Container){const h=y.getBBox();return f.cell.toFront({deep:!0}),i.isIntersectWithRect(h)}return!1})}}});e.drawer.setGraph(r);const u=(n=o.children)==null?void 0:n.map(c=>_e(c));u&&r.addNodes(u)}}),{workspace:t}},render(){return s("div",{ref:"workspace"},null)}});const Ee=()=>({drawer:new Ce({attrs:{type:w.Canvas,id:"1",name:"Pc Form Demo",width:800,height:600,offsetX:0,offsetY:0}}),header:Se,side:Be,workspace:Me}),Re={PcForm:()=>Ee()};var Ae=g({name:"SaFormLayoutHeader",props:{options:{required:!0,type:Array},drawer:{required:!0,type:Object}},render(){return s("div",{class:"sa-form-header flex justify-start p-1"},[this.options.map(e=>s("span",{class:"header-tool",onClick:t=>e.click(this.drawer,t),title:e.title,style:{width:e.width?`${e.width}px`:"30px",height:"30px"}},[e.icon]))])}}),Fe=g({name:"CoFormLayoutSidebar",props:{options:{required:!0,type:Array},drawer:{required:!0,type:Object}},setup(e){const t=b(null),n=B(()=>e.drawer.graph);let o;return H(()=>n.value,()=>{var r;if(console.log("GRAPH CHANGE"),n.value&&!o){console.log(n.value,t.value),o=new ae({title:"Components",target:n.value,search(c,f){return c.shape.indexOf(f)!==-1},placeholder:"Search by shape name",notFoundText:"Not Found",collapsable:!0,stencilGraphWidth:208,stencilGraphHeight:180,groups:[{name:"group1",title:"Group(Collapsable)"},{name:"group2",title:"Group",collapsable:!1}]});const u=new $({width:80,height:40,attrs:{rect:{fill:"#31D0C6",stroke:"#4B4A67",strokeWidth:1},text:{text:"Button",fill:"white"}}});(r=t.value)==null||r.appendChild(o.container),o.load([u],"group1")}}),{graph:n,refStencil:t,stencil:o}},render(){return s("div",{class:"sa-form-side flex flex-col justify-start p-1 relative w-52"},[s("div",{ref:"refStencil"},null)])}}),Oe=g({props:{type:{required:!0,type:String},id:{required:!0,type:String}},setup(e,t){const n=T(Re[e.type]()),o=n.workspace;return()=>s("section",{class:"flex flex-col"},[s("h1",{class:"font-bold text-lg py-4"},[k("Sa Form")]),s("header",null,[s(le,null,{default:()=>[s(Ae,{options:n.header,drawer:n.drawer,class:"bg-slate-500"},null)]})]),s("main",{class:"mt-1 flex flex-grow"},[s("aside",null,[s(Fe,{options:n.side,drawer:n.drawer,class:"bg-slate-500 h-full"},null)]),s("main",{class:"flex-grow justify-center bg-slate-500 mx-1 overflow-auto"},[s(o,{drawer:n.drawer},null)]),s("aside",{class:"w-48 bg-slate-500"},[k("properties controller")])])])}});const je={class:"w-3/5 mx-auto h-full"},Ie=g({setup(e){return(t,n)=>(me(),ce("div",je,[s(de(Oe),{id:"1",type:"PcForm",class:"h-1/2"})]))}});const Y=(e,t)=>{var u;const n=t.arg;if(!n){console.error("\u53C2\u6570\u6709\u8BEF");return}const o=t.value,r=he(n)?n.value:(u=t.instance)==null?void 0:u.$refs[n];if(!r){console.error(`\u6CA1\u6709\u627E\u5230 ${n} \u5BF9\u5E94\u7684\u5B9E\u4F8B`);return}if(typeof r.addReference!="function"){console.error(`${n} \u5BF9\u5E94\u7684\u5B9E\u4F8B\u4E0D\u662F VContextmenu`);return}e.$contextmenuKey=n,r.addReference(e,o)},q=(e,t)=>{var r;const n=e.$contextmenuKey;if(!n)return;const o=(r=t.instance)==null?void 0:r.$refs[n];o==null||o.removeReference(e)},$e=(e,t)=>{q(e,t),Y(e,t)},De={mounted:Y,updated:$e,beforeUnmount:q},a={contextmenu:"v-contextmenu",contextmenuIcon:"v-contextmenu-icon",contextmenuInner:"v-contextmenu-inner",contextmenuDivider:"v-contextmenu-divider",contextmenuItem:"v-contextmenu-item",contextmenuItemHover:"v-contextmenu-item--hover",contextmenuItemDisabled:"v-contextmenu-item--disabled",contextmenuGroup:"v-contextmenu-group",contextmenuGroupTitle:"v-contextmenu-group__title",contextmenuGroupMenus:"v-contextmenu-group__menus",contextmenuSubmenu:"v-contextmenu-submenu",contextmenuSubmenuTitle:"v-contextmenu-submenu__title",contextmenuSubmenuMenus:"v-contextmenu-submenu__menus",contextmenuSubmenuMenusTop:"v-contextmenu-submenu__menus--top",contextmenuSubmenuMenusRight:"v-contextmenu-submenu__menus--right",contextmenuSubmenuMenusBottom:"v-contextmenu-submenu__menus--bottom",contextmenuSubmenuMenusLeft:"v-contextmenu-submenu__menus--left",contextmenuSubmenuArrow:"v-contextmenu-submenu__arrow"};function Ge(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!ge(e)}const Le={trigger:["contextmenu"]},K=g({name:"VContextmenu",props:{modelValue:{type:Boolean,default:!1},autoAjustPlacement:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1},teleport:{type:[String,Object],default:()=>"body"}},emits:["show","hide","update:modelValue"],setup(e,{emit:t}){const n=b(null),o=b(e.modelValue||!1),r=l=>{o.value=l,t("update:modelValue",l)},u=b({top:0,left:0}),c=B(()=>({top:`${u.value.top}px`,left:`${u.value.left}px`})),f=b(null),i=(l,p)=>{var G,L;const d=l instanceof Event?p:l,E=(d==null?void 0:d.autoAjustPlacement)||e.autoAjustPlacement,x={top:(d==null?void 0:d.top)||0,left:(d==null?void 0:d.left)||0};l instanceof Event&&(l.preventDefault(),x.top=(G=d==null?void 0:d.top)!=null?G:l.pageY,x.left=(L=d==null?void 0:d.left)!=null?L:l.pageX),r(!0),z(()=>{if(E){const F=n.value;if(!F)return;const W=F.clientWidth,N=F.clientHeight;if(N+x.top>=window.innerHeight+window.scrollY){const P=x.top-N;P>window.scrollY&&(x.top=P)}if(W+x.left>=window.innerWidth+window.scrollX){const P=x.left-W;P>window.scrollX&&(x.left=P)}}u.value=x,t("show")})},y=()=>{f.value=null,r(!1),t("hide")},m=T(new Map),h=b(),C=B(()=>h.value&&m.get(h.value)),S=(l,p)=>{const d=(()=>(p==null?void 0:p.trigger)?Array.isArray(p.trigger)?p.trigger:[p.trigger]:Le.trigger)(),E=x=>{e.disabled||(h.value=l,i(x,{}))};d.forEach(x=>{l.addEventListener(x,E)}),m.set(l,{triggers:d,handler:E})},A=l=>{const p=m.get(l);!p||(p.triggers.forEach(d=>{l.removeEventListener(d,p.handler)}),m.delete(l))},_=l=>{if(!l.target||!n.value||!h.value)return;n.value.contains(l.target)||C.value&&C.value.triggers.includes("click")&&h.value.contains(l.target)||r(!1)};return H(o,l=>{l?document.addEventListener("click",_):document.removeEventListener("click",_)}),fe(()=>{document.removeEventListener("click",_)}),R("visible",o),R("autoAjustPlacement",e.autoAjustPlacement),R("show",i),R("hide",y),{visible:o,style:c,currentReferenceOptions:C,currentOptions:f,contextmenuRef:n,addReference:S,removeReference:A,toggle:r,show:i,hide:y}},methods:{renderContent(){var e,t;return pe(s("div",{class:a.contextmenu,ref:"contextmenuRef",style:this.style},[s("ul",{class:a.contextmenuInner},[(t=(e=this.$slots).default)==null?void 0:t.call(e,{triggerOptions:"currentReferenceOptions",options:"currentOptions"})])]),[[xe,"visible"]])}},render(){let e;return this.visible?this.teleport?s(ve,{to:this.teleport},Ge(e=this.renderContent())?e:{default:()=>[e]}):this.renderContent():null}}),U=g({name:"VContextmenuItem",props:{disabled:{type:Boolean,default:!1},hideOnClick:{type:Boolean,default:!0}},emits:["click","mouseenter","mouseleave"],setup(e,{emit:t}){const n=X("hide"),o=b(!1);return{classes:B(()=>({[a.contextmenuItem]:!0,[a.contextmenuItemDisabled]:e.disabled,[a.contextmenuItemHover]:o.value})),handleClick:i=>{e.disabled||(t("click",i),e.hideOnClick&&(n==null||n()))},handleMouseenter:i=>{e.disabled||(o.value=!0,t("mouseenter",i))},handleMouseleave:i=>{e.disabled||(o.value=!1,t("mouseleave",i))}}},render(){var e,t;return s("li",{class:this.classes,onClick:this.handleClick,onMouseenter:this.handleMouseenter,onMouseleave:this.handleMouseleave},[(t=(e=this.$slots).default)==null?void 0:t.call(e)])}}),J=g({name:"VContextmenuDivider",render(){return s("li",{class:a.contextmenuDivider},null)}}),We=g({name:"VContextmenuIcon",props:{name:{type:String,required:!0}},render(){return s("i",{class:[a.contextmenuIcon,`${a.contextmenuIcon}-${this.name}`]},null)}}),Q=g({name:"VContextmenuSubmenu",props:{title:{type:String,required:!0},disabled:{type:Boolean,default:!1}},emits:["mouseenter","mouseleave"],setup(e,{emit:t}){const n=b(null),o=X("autoAjustPlacement"),r=b(["top","right"]),u=b(!1),c=m=>{e.disabled||(u.value=!0,t("mouseenter",m),z(()=>{const h=[];if(o){const{target:C}=m,S=C.getBoundingClientRect();if(!n.value)return;const A=n.value.clientWidth,_=n.value.clientHeight;S.right+A>=window.innerWidth?h.push("left"):h.push("right"),S.bottom+_>=window.innerHeight?h.push("bottom"):h.push("top")}r.value=h}))},f=m=>{e.disabled||(u.value=!1,t("mouseleave",m))},i=B(()=>({[a.contextmenuItem]:!0,[a.contextmenuSubmenuTitle]:!0,[a.contextmenuItemHover]:u.value,[a.contextmenuItemDisabled]:e.disabled})),y=B(()=>({[a.contextmenu]:!0,[a.contextmenuSubmenuMenus]:!0,[a.contextmenuSubmenuMenusTop]:r.value.includes("top"),[a.contextmenuSubmenuMenusRight]:r.value.includes("right"),[a.contextmenuSubmenuMenusBottom]:r.value.includes("bottom"),[a.contextmenuSubmenuMenusLeft]:r.value.includes("left")}));return{hover:u,submenuRef:n,titleClasses:i,menusClasses:y,handleMouseenter:c,handleMouseleave:f}},render(){var e,t,n,o;return s("li",{class:a.contextmenuSubmenu,onMouseenter:this.handleMouseenter,onMouseleave:this.handleMouseleave},[s("div",{class:this.titleClasses},[((t=(e=this.$slots).title)==null?void 0:t.call(e))||this.title,s("span",{class:a.contextmenuSubmenuArrow},[s(We,{name:"right-arrow"},null)])]),this.hover?s("div",{ref:"submenuRef",class:this.menusClasses},[s("ul",{class:a.contextmenuInner},[(o=(n=this.$slots).default)==null?void 0:o.call(n)])]):null])}}),Z=g({name:"VContextmenuGroup",props:{title:{type:String,default:void 0},maxWidth:{type:[Number,String],default:void 0}},setup(e){return{style:B(()=>{if(!!e.maxWidth)return{"max-width":typeof e.maxWidth=="number"?`${e.maxWidth}px`:e.maxWidth,"overflow-x":"auto"}})}},methods:{renderTitle(){var t,n;const e=((n=(t=this.$slots).title)==null?void 0:n.call(t))||this.title;return e?s("div",{class:a.contextmenuGroupTitle},[e]):null}},render(){var e,t;return s("li",{class:a.contextmenuGroup},[this.renderTitle(),s("ul",{style:this.style,class:a.contextmenuGroupMenus},[(t=(e=this.$slots).default)==null?void 0:t.call(e)])])}}),Ne=e=>{e.directive("contextmenu",De),e.component(K.name,K),e.component(U.name,U),e.component(J.name,J),e.component(Q.name,Q),e.component(Z.name,Z)},Ve={install:Ne},ee=be(Ie);ee.use(Ve);ee.mount("#app");
