var se=Object.defineProperty,ue=Object.defineProperties;var ie=Object.getOwnPropertyDescriptors;var H=Object.getOwnPropertySymbols;var le=Object.prototype.hasOwnProperty,ae=Object.prototype.propertyIsEnumerable;var A=(e,t,n)=>t in e?se(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,I=(e,t)=>{for(var n in t||(t={}))le.call(t,n)&&A(e,n,t[n]);if(H)for(var n of H(t))ae.call(t,n)&&A(e,n,t[n]);return e},$=(e,t)=>ue(e,ie(t));var v=(e,t,n)=>(A(e,typeof t!="symbol"?t+"":t,n),n);import{c as s,a as B,R as D,d as C,r as w,o as ce,G as de,b as T,e as M,f as me,g as P,w as z,S as he,h as X,E as fe,i as pe,u as xe,j as ve,k as ge,p as O,l as be,v as we,T as ye,m as Y,n as K,q as U,s as Ce,t as Se}from"./vendor.33f73341.js";const ke=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const u of o)if(u.type==="childList")for(const c of u.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function n(o){const u={};return o.integrity&&(u.integrity=o.integrity),o.referrerpolicy&&(u.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?u.credentials="include":o.crossorigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function r(o){if(o.ep)return;o.ep=!0;const u=n(o);fetch(o.href,u)}};ke();class j{constructor(t){v(this,"parent");v(this,"children");v(this,"attrs");this.parent=t.parent,this.attrs=t.attrs,t.children&&(this.children=t.children)}}class Be{constructor(t){v(this,"records",[]);v(this,"index",0);v(this,"max");v(this,"recording");var n,r;this.max=(n=t==null?void 0:t.max)!=null?n:20,this.recording=(r=t==null?void 0:t.recording)!=null?r:!0}}class _e{constructor(t){v(this,"type");v(this,"canvas");v(this,"record");v(this,"selected",[]);v(this,"graph");this.type="PcForm",this.record=new Be,this.canvas=new j({parent:void 0,children:[],attrs:t.attrs})}setGraph(t){this.graph=t}}const Pe=[{title:"undo",icon:s("span",null,[B("undo")]),click:e=>{var t;return console.log("undo",(t=e.graph)==null?void 0:t.undo())}},{title:"redo",icon:s("span",null,[B("redo")]),click:e=>{var t;return console.log("redo",(t=e.graph)==null?void 0:t.redo())}}],Me=[{title:"Button",icon:s("span",null,[B("Button")])},{title:"Container",icon:s("span",null,[B("container")])}];var S;(function(e){e[e.Canvas=0]="Canvas",e[e.Button=1]="Button",e[e.Container=2]="Container"})(S||(S={}));const Ee=()=>{var o;const e=new j({parent:void 0,children:[],attrs:{type:S.Canvas,id:"1",name:"mock pc form",width:800,height:600,offsetX:0,offsetY:0}}),t=new j({parent:e,attrs:{id:"2",type:S.Button,name:"mock button 1",width:80,height:40,offsetX:200,offsetY:100}}),n=new j({parent:e,attrs:{type:S.Button,id:"3",name:"mock button 2",width:80,height:40,offsetX:150,offsetY:200}}),r=new j({parent:e,attrs:{type:S.Container,id:"4",name:"mock container",width:400,height:200,offsetX:50,offsetY:300}});return(o=e.children)==null||o.push(t,n,r),e};function je(e){const t=Object.assign({id:e.attrs.id,x:e.attrs.offsetX,y:e.attrs.offsetY,width:e.attrs.width,height:e.attrs.height},{data:e.attrs});switch(e.attrs.type){case S.Button:return new D($(I({},t),{attrs:{rect:{fill:"#31D0C6",stroke:"#4B4A67",strokeWidth:1},text:{text:S[e.attrs.type],fill:"white"}}}));case S.Container:return new D($(I({},t),{attrs:{rect:{fill:"#31D0C6",stroke:"#4B4A67",strokeWidth:1}}}));default:throw new Error(`[Sa error]: unexpected element type ${e.attrs.type}.`)}}function Fe(e){const t=e.cells,n=L(t[0]);let r=n.position.x,o=n.position.x+n.size.width,u=n.position.y,c=n.position.y+n.size.height;return t.forEach(g=>{const i=L(g);i.position.x<r&&(r=i.position.x),o<i.position.x+i.size.width&&(o=i.position.x+i.size.width),i.position.y<u&&(u=i.position.y),c<i.position.y+i.size.height&&(c=i.position.y+i.size.height)}),{x:r,y:u,width:o-r,height:c-u}}function L(e){return{position:e.getProp("position"),size:e.getProp("size")}}function J(e,t){if(!e)return;let n;if(t)return typeof t=="object"?n=t.toJSON().id:n=t,e.removeNode(n);const r=e.getSelectedCells();if(r.length)for(const o of r)J(e,o)}var Oe=C({name:"SaPcFormRender",props:{drawer:{required:!0,type:Object}},setup(e){const t=w(null),n=w(null);return ce(()=>{var o;if(t.value){const u=Ee();console.log("create graph",u);const c=new de({container:t.value,autoResize:!0,history:!0,width:u.attrs.width,height:u.attrs.height,snapline:!0,grid:{visible:!0,type:"doubleMesh",args:[{color:"#eee",thickness:1},{color:"#ddd",thickness:1,factor:4}]},selecting:{enabled:!0,multiple:!0,rubberband:!0,movable:!0,showEdgeSelectionBox:!0},rotating:{enabled:!0,grid:15},resizing:!0,translating:{restrict(i){var h;const b=i.cell;if(b.isNode()){const m=b.getParent();if(m){const f=m.getBBox(),y=i.graph.selection;if((h=y==null?void 0:y.cells)==null?void 0:h.length){const _=Fe(y),k=L(b);return{x:f.x+k.position.x-_.x,y:f.y+k.position.y-_.y,width:f.width-(_.width-k.size.width),height:f.height-(_.height-k.size.height)}}return f}}return{x:0,y:0,width:u.attrs.width,height:u.attrs.height}}},clipboard:{enabled:!0,useLocalStorage:!0},embedding:{enabled:!0,frontOnly:!1,findParent({node:i,view:b}){const h=i.getBBox();return this.getNodes().filter(m=>{const f=m.getData();if(f&&f.type===S.Container){const y=m.getBBox();return b.cell.toFront({deep:!0}),h.isIntersectWithRect(y)}return!1})}}});e.drawer.setGraph(c);const g=(o=u.children)==null?void 0:o.map(i=>je(i));g&&c.addNodes(g),c.on("cell:contextmenu",({cell:i,e:b})=>{c.cleanSelection(),c.select(i),n.value.show(b.originalEvent),document.addEventListener("click",r)})}function r(){n.value&&n.value.visible&&n.value.hide()}T(()=>{document.removeEventListener("click",r)})}),{workspace:t,contextmenu:n}},render(){return s("div",null,[s("div",{ref:"workspace"},null),s(M("v-contextmenu"),{ref:"contextmenu"},{default:()=>[s(M("v-contextmenu-item"),{onClick:()=>{}},{default:()=>[B("copy")]}),s(M("v-contextmenu-item"),{onClick:()=>{}},{default:()=>[B("cut")]}),s(M("v-contextmenu-item"),{onClick:()=>{}},{default:()=>[B("paste")]}),s(M("v-contextmenu-item"),{type:"danger",icon:s(me,null,null),onClick:()=>J(this.drawer.graph)},{default:()=>[B("delete")]})]})])}});const Re=()=>({drawer:new _e({attrs:{type:S.Canvas,id:"1",name:"Pc Form Demo",width:800,height:600,offsetX:0,offsetY:0}}),header:Pe,side:Me,workspace:Oe}),Ae={PcForm:()=>Re()};var Ie=C({name:"SaFormLayoutHeader",props:{options:{required:!0,type:Array},drawer:{required:!0,type:Object}},render(){return s("div",{class:"sa-form-header flex justify-start p-1"},[this.options.map(e=>s("span",{class:"header-tool",onClick:t=>e.click(this.drawer,t),title:e.title,style:{width:e.width?`${e.width}px`:"30px",height:"30px"}},[e.icon]))])}}),$e=C({name:"CoFormLayoutSidebar",props:{options:{required:!0,type:Array},drawer:{required:!0,type:Object}},setup(e){const t=w(null),n=P(()=>e.drawer.graph);let r;return z(()=>n.value,()=>{var o;if(console.log("GRAPH CHANGE"),n.value&&!r){console.log(n.value,t.value),r=new he({title:"Components",target:n.value,search(c,g){return c.shape.indexOf(g)!==-1},placeholder:"Search by shape name",notFoundText:"Not Found",collapsable:!0,stencilGraphWidth:208,stencilGraphHeight:180,groups:[{name:"group1",title:"Group(Collapsable)"},{name:"group2",title:"Group",collapsable:!1}]});const u=new D({width:80,height:40,attrs:{rect:{fill:"#31D0C6",stroke:"#4B4A67",strokeWidth:1},text:{text:"Button",fill:"white"}}});(o=t.value)==null||o.appendChild(r.container),r.load([u],"group1")}}),{graph:n,refStencil:t,stencil:r}},render(){return s("div",{class:"sa-form-side flex flex-col justify-start p-1 relative w-52"},[s("div",{ref:"refStencil"},null)])}}),De=C({props:{type:{required:!0,type:String},id:{required:!0,type:String}},setup(e,t){const n=X(Ae[e.type]()),r=n.workspace;return()=>s("section",{class:"flex flex-col"},[s("h1",{class:"font-bold text-lg py-4"},[B("Sa Form")]),s("header",null,[s(fe,null,{default:()=>[s(Ie,{options:n.header,drawer:n.drawer,class:"bg-slate-500"},null)]})]),s("main",{class:"mt-1 flex flex-grow"},[s("aside",null,[s($e,{options:n.side,drawer:n.drawer,class:"bg-slate-500 h-full"},null)]),s("main",{class:"flex-grow justify-center bg-slate-500 mx-1 overflow-auto"},[s(r,{drawer:n.drawer},null)]),s("aside",{class:"w-48 bg-slate-500"},[B("properties controller")])])])}});const Le={class:"w-3/5 mx-auto h-full"},Ne=C({setup(e){return(t,n)=>(ve(),pe("div",Le,[s(xe(De),{id:"1",type:"PcForm",class:"h-1/2"})]))}});const Q=(e,t)=>{var u;const n=t.arg;if(!n){console.error("\u53C2\u6570\u6709\u8BEF");return}const r=t.value,o=ge(n)?n.value:(u=t.instance)==null?void 0:u.$refs[n];if(!o){console.error(`\u6CA1\u6709\u627E\u5230 ${n} \u5BF9\u5E94\u7684\u5B9E\u4F8B`);return}if(typeof o.addReference!="function"){console.error(`${n} \u5BF9\u5E94\u7684\u5B9E\u4F8B\u4E0D\u662F VContextmenu`);return}e.$contextmenuKey=n,o.addReference(e,r)},Z=(e,t)=>{var o;const n=e.$contextmenuKey;if(!n)return;const r=(o=t.instance)==null?void 0:o.$refs[n];r==null||r.removeReference(e)},Ge=(e,t)=>{Z(e,t),Q(e,t)},We={mounted:Q,updated:Ge,beforeUnmount:Z},l={contextmenu:"v-contextmenu",contextmenuIcon:"v-contextmenu-icon",contextmenuInner:"v-contextmenu-inner",contextmenuDivider:"v-contextmenu-divider",contextmenuItem:"v-contextmenu-item",contextmenuItemHover:"v-contextmenu-item--hover",contextmenuItemDisabled:"v-contextmenu-item--disabled",contextmenuItemDanger:"v-contextmenu-item--danger",contextmenuGroup:"v-contextmenu-group",contextmenuGroupTitle:"v-contextmenu-group__title",contextmenuGroupMenus:"v-contextmenu-group__menus",contextmenuSubmenu:"v-contextmenu-submenu",contextmenuSubmenuTitle:"v-contextmenu-submenu__title",contextmenuSubmenuMenus:"v-contextmenu-submenu__menus",contextmenuSubmenuMenusTop:"v-contextmenu-submenu__menus--top",contextmenuSubmenuMenusRight:"v-contextmenu-submenu__menus--right",contextmenuSubmenuMenusBottom:"v-contextmenu-submenu__menus--bottom",contextmenuSubmenuMenusLeft:"v-contextmenu-submenu__menus--left",contextmenuSubmenuArrow:"v-contextmenu-submenu__arrow"};function Ve(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Y(e)}const qe={trigger:["contextmenu"]},ee=C({name:"VContextmenu",props:{modelValue:{type:Boolean,default:!1},autoAjustPlacement:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1},teleport:{type:[String,Object],default:()=>"body"}},emits:["show","hide","update:modelValue"],setup(e,{emit:t}){const n=w(null),r=w(e.modelValue||!1),o=a=>{r.value=a,t("update:modelValue",a)},u=w({top:0,left:0}),c=P(()=>({top:`${u.value.top}px`,left:`${u.value.left}px`})),g=w(null),i=(a,p)=>{var G,W;const d=a instanceof Event?p:a,F=(d==null?void 0:d.autoAjustPlacement)||e.autoAjustPlacement,x={top:(d==null?void 0:d.top)||0,left:(d==null?void 0:d.left)||0};a instanceof Event&&(a.preventDefault(),x.top=(G=d==null?void 0:d.top)!=null?G:a.pageY,x.left=(W=d==null?void 0:d.left)!=null?W:a.pageX),o(!0),K(()=>{if(F){const R=n.value;if(!R)return;const V=R.clientWidth,q=R.clientHeight;if(q+x.top>=window.innerHeight+window.scrollY){const E=x.top-q;E>window.scrollY&&(x.top=E)}if(V+x.left>=window.innerWidth+window.scrollX){const E=x.left-V;E>window.scrollX&&(x.left=E)}}u.value=x,t("show")})},b=()=>{g.value=null,o(!1),t("hide")},h=X(new Map),m=w(),f=P(()=>m.value&&h.get(m.value)),y=(a,p)=>{const d=(()=>(p==null?void 0:p.trigger)?Array.isArray(p.trigger)?p.trigger:[p.trigger]:qe.trigger)(),F=x=>{e.disabled||(m.value=a,i(x,{}))};d.forEach(x=>{a.addEventListener(x,F)}),h.set(a,{triggers:d,handler:F})},_=a=>{const p=h.get(a);!p||(p.triggers.forEach(d=>{a.removeEventListener(d,p.handler)}),h.delete(a))},k=a=>{if(!a.target||!n.value||!m.value)return;n.value.contains(a.target)||f.value&&f.value.triggers.includes("click")&&m.value.contains(a.target)||o(!1)};return z(r,a=>{a?document.addEventListener("click",k):document.removeEventListener("click",k)}),T(()=>{document.removeEventListener("click",k)}),O("visible",r),O("autoAjustPlacement",e.autoAjustPlacement),O("show",i),O("hide",b),{visible:r,style:c,currentReferenceOptions:f,currentOptions:g,contextmenuRef:n,addReference:y,removeReference:_,toggle:o,show:i,hide:b}},methods:{renderContent(){var e,t;return be(s("div",{class:l.contextmenu,ref:"contextmenuRef",style:this.style},[s("ul",{class:l.contextmenuInner},[(t=(e=this.$slots).default)==null?void 0:t.call(e,{triggerOptions:"currentReferenceOptions",options:"currentOptions"})])]),[[we,"visible"]])}},render(){let e;return this.visible?this.teleport?s(ye,{to:this.teleport},Ve(e=this.renderContent())?e:{default:()=>[e]}):this.renderContent():null}});function He(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Y(e)}const te=C({name:"VContextmenuItem",props:{disabled:{type:Boolean,default:!1},hideOnClick:{type:Boolean,default:!0},icon:{required:!1,type:Object},type:{requred:!1,type:String}},emits:["click","mouseenter","mouseleave"],setup(e,{emit:t}){const n=U("hide"),r=w(!1);return{classes:P(()=>({[l.contextmenuItem]:!0,[l.contextmenuItemDisabled]:e.disabled,[l.contextmenuItemHover]:r.value,[l.contextmenuItemDanger]:e.type==="danger"})),handleClick:i=>{e.disabled||(t("click",i),e.hideOnClick&&(n==null||n()))},handleMouseenter:i=>{e.disabled||(r.value=!0,t("mouseenter",i))},handleMouseleave:i=>{e.disabled||(r.value=!1,t("mouseleave",i))}}},render(){var t,n;const e=this.icon;return s("li",{class:this.classes,onClick:this.handleClick,onMouseenter:this.handleMouseenter,onMouseleave:this.handleMouseleave},[e?s(M("el-icon"),{class:"mr-1 leading-0"},He(e)?e:{default:()=>[e]}):s("span",{style:{width:"18px"}},null),(n=(t=this.$slots).default)==null?void 0:n.call(t)])}}),ne=C({name:"VContextmenuDivider",render(){return s("li",{class:l.contextmenuDivider},null)}}),Te=C({name:"VContextmenuIcon",props:{name:{type:String,required:!0}},render(){return s("i",{class:[l.contextmenuIcon,`${l.contextmenuIcon}-${this.name}`]},null)}}),oe=C({name:"VContextmenuSubmenu",props:{title:{type:String,required:!0},disabled:{type:Boolean,default:!1}},emits:["mouseenter","mouseleave"],setup(e,{emit:t}){const n=w(null),r=U("autoAjustPlacement"),o=w(["top","right"]),u=w(!1),c=h=>{e.disabled||(u.value=!0,t("mouseenter",h),K(()=>{const m=[];if(r){const{target:f}=h,y=f.getBoundingClientRect();if(!n.value)return;const _=n.value.clientWidth,k=n.value.clientHeight;y.right+_>=window.innerWidth?m.push("left"):m.push("right"),y.bottom+k>=window.innerHeight?m.push("bottom"):m.push("top")}o.value=m}))},g=h=>{e.disabled||(u.value=!1,t("mouseleave",h))},i=P(()=>({[l.contextmenuItem]:!0,[l.contextmenuSubmenuTitle]:!0,[l.contextmenuItemHover]:u.value,[l.contextmenuItemDisabled]:e.disabled})),b=P(()=>({[l.contextmenu]:!0,[l.contextmenuSubmenuMenus]:!0,[l.contextmenuSubmenuMenusTop]:o.value.includes("top"),[l.contextmenuSubmenuMenusRight]:o.value.includes("right"),[l.contextmenuSubmenuMenusBottom]:o.value.includes("bottom"),[l.contextmenuSubmenuMenusLeft]:o.value.includes("left")}));return{hover:u,submenuRef:n,titleClasses:i,menusClasses:b,handleMouseenter:c,handleMouseleave:g}},render(){var e,t,n,r;return s("li",{class:l.contextmenuSubmenu,onMouseenter:this.handleMouseenter,onMouseleave:this.handleMouseleave},[s("div",{class:this.titleClasses},[((t=(e=this.$slots).title)==null?void 0:t.call(e))||this.title,s("span",{class:l.contextmenuSubmenuArrow},[s(Te,{name:"right-arrow"},null)])]),this.hover?s("div",{ref:"submenuRef",class:this.menusClasses},[s("ul",{class:l.contextmenuInner},[(r=(n=this.$slots).default)==null?void 0:r.call(n)])]):null])}}),re=C({name:"VContextmenuGroup",props:{title:{type:String,default:void 0},maxWidth:{type:[Number,String],default:void 0}},setup(e){return{style:P(()=>{if(!!e.maxWidth)return{"max-width":typeof e.maxWidth=="number"?`${e.maxWidth}px`:e.maxWidth,"overflow-x":"auto"}})}},methods:{renderTitle(){var t,n;const e=((n=(t=this.$slots).title)==null?void 0:n.call(t))||this.title;return e?s("div",{class:l.contextmenuGroupTitle},[e]):null}},render(){var e,t;return s("li",{class:l.contextmenuGroup},[this.renderTitle(),s("ul",{style:this.style,class:l.contextmenuGroupMenus},[(t=(e=this.$slots).default)==null?void 0:t.call(e)])])}}),ze=e=>{e.directive("contextmenu",We),e.component(ee.name,ee),e.component(te.name,te),e.component(ne.name,ne),e.component(oe.name,oe),e.component(re.name,re)},Xe={install:ze},N=Ce(Ne);N.use(Xe);N.use(Se);N.mount("#app");
