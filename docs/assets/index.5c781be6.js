var Ne=Object.defineProperty,De=Object.defineProperties;var Ie=Object.getOwnPropertyDescriptors;var re=Object.getOwnPropertySymbols;var ke=Object.prototype.hasOwnProperty,Pe=Object.prototype.propertyIsEnumerable;var H=(e,t,n)=>t in e?Ne(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,j=(e,t)=>{for(var n in t||(t={}))ke.call(t,n)&&H(e,n,t[n]);if(re)for(var n of re(t))Pe.call(t,n)&&H(e,n,t[n]);return e},$=(e,t)=>De(e,Ie(t));var b=(e,t,n)=>(H(e,typeof t!="symbol"?t+"":t,n),n);import{c as A,f as E,a as U,A as Ae,R as O,s as V,p as ie,r as Ee,b as a,d as S,e as D,g as oe,o as Be,G as Re,h as je,i as B,j as M,k as F,l as _e,F as Me,w as ae,S as Oe,E as Fe,m as Ye,n as le,q as Xe,t as $e,u as Le,v as ze,x as Ve,y as We,z as W,B as qe,C as Ge,T as He,D as ce,H as ue,I as de,J as Ue,K as Ke}from"./vendor.5afdcc61.js";const Te=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerpolicy&&(i.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?i.credentials="include":s.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}};Te();var I;(function(e){e[e.Add=0]="Add",e[e.Delete=1]="Delete",e[e.Move=2]="Move",e[e.Attr=3]="Attr"})(I||(I={}));function he(e){return Reflect.has(e[0],"id")}function Je(e){return!Reflect.has(e[0],"id")}class _{constructor(t){b(this,"parent");b(this,"children");b(this,"attrs");this.parent=t.parent,this.attrs=A(t.attrs),t.children&&(this.children=t.children)}}class L{constructor(t){b(this,"type");b(this,"time");b(this,"data");this.time=t.time,this.type=t.type,this.data=t.data}}class Qe{constructor(t){b(this,"records",[]);b(this,"index",-1);b(this,"max");b(this,"recording");var n,r;this.max=(n=t==null?void 0:t.max)!=null?n:20,this.recording=(r=t==null?void 0:t.recording)!=null?r:!0}getPrevRecord(){if(!(this.index<0))return this.records[this.index]}getNextRecord(){if(!(this.index>=this.records.length-1))return this.records[this.index+1]}}function K(e){const t=z(e[0]);let n=t.position.x,r=t.position.x+t.size.width,s=t.position.y,i=t.position.y+t.size.height;return e.forEach(o=>{const l=z(o);l.position.x<n&&(n=l.position.x),r<l.position.x+l.size.width&&(r=l.position.x+l.size.width),l.position.y<s&&(s=l.position.y),i<l.position.y+l.size.height&&(i=l.position.y+l.size.height)}),{x:n,y:s,width:r-n,height:i-s}}function z(e){return e instanceof _?{position:{x:e.attrs.offsetX,y:e.attrs.offsetY},size:{width:e.attrs.width,height:e.attrs.height}}:{position:e.getProp("position"),size:e.getProp("size")}}function Ze(e){const t=r(e),n=Number(t);return n?(n+1).toString():"1";function r(s){var d;const i=s.attrs.id;let o="";if((d=s.children)==null?void 0:d.length)for(const y of s.children){const w=r(y),u=Number(o),f=Number(w);u&&f&&(o=Math.max(u,f).toString()),f&&(o=w)}const l=Number(o),c=Number(i);return l&&c?Math.max(l,c).toString():l?o:i}}function et(e,t,{canvas:n}){var s,i;const r=(s=e.parent)==null?void 0:s.data.id;return new t({attrs:e.data,parent:j({},r&&(i=E(n,o=>o.attrs.id===r))!=null?i:n),children:[]})}function T(e,t){const n=Array.isArray(e)?e:[e],r=t.getSelectedCells().filter(s=>!n.includes(s.data.id));for(const s of n)t.isSelected(s)||t.select(s);for(const s of r)t.unselect(s)}var x;(function(e){e[e.Canvas=1]="Canvas",e[e.Button=2]="Button",e[e.Select=3]="Select",e[e.Container=4]="Container"})(x||(x={}));function J(e,t){var r;if(!(e==null?void 0:e.graph))return;if(t){const s=[];for(const l of t)typeof l=="object"?s.push(l.toJSON().id):s.push(l);const i=s.map(l=>U(e.canvas.children,c=>c.attrs.id===l)),o=new L({type:I.Delete,time:new Date,data:i.map(l=>({prev:A(l)}))});e.addRecord(o),e.graph.removeCells(s);for(const l of i)((r=l.parent)==null?void 0:r.children)&&Ae.remove(l.parent.children,c=>c.attrs.id===l.attrs.id);return i}const n=e.graph.getSelectedCells();n.length&&J(e,n)}function tt(e){e.clipboard.copy(e,{deep:!0,useLocalStorage:!0})}function nt(e){e.clipboard.cut(e,{deep:!0,useLocalStorage:!0})}function fe(e,t,n){if(n.clipboard.isEmpty(n.clipboard.clips)||!n.graph)return;if(t&&t.data.type!==x.Container)return console.error(`[Sa error]: can not paste elements in ${x[t.data.type]}.`);const r=K(n.clipboard.clips.elements),s=r.x-e.offsetX,i=r.y-e.offsetY;n.clipboard.paste(n,t==null?void 0:t.data.id,{deep:!0,nodeProps:o=>({id:n.getNextId(),offsetX:o.attrs.offsetX-s,offsetY:o.attrs.offsetY-i})})}function Y(e){const t=Object.assign({id:e.attrs.id,x:e.attrs.offsetX,y:e.attrs.offsetY,width:e.attrs.width,height:e.attrs.height},{data:e.attrs});switch(e.attrs.type){case x.Button:return new O($(j({},t),{attrs:{rect:{fill:"#31D0C6",stroke:"#4B4A67",strokeWidth:1},text:{text:x[e.attrs.type],fill:"white"}}}));case x.Select:return new O($(j({},t),{attrs:{rect:{fill:"#31D0C6",stroke:"#4B4A67",strokeWidth:1},text:{text:x[e.attrs.type],fill:"white"}}}));case x.Container:return new O($(j({},t),{attrs:{rect:{fill:"#31D0C6",stroke:"#4B4A67",strokeWidth:1}}}));default:throw new Error(`[Sa error]: unexpected element type ${e.attrs.type}.`)}}class st{constructor(){b(this,"clips")}isEmpty(t=this.clips){var n;return!((n=this.clips)==null?void 0:n.elements.length)}copy(t,n){this.clips={elements:A(t.selected),type:"copy"}}cut(t,n){this.clips={elements:A(t.selected),type:"cut"},J(t)}paste(t,n=t.canvas.attrs.id,r){if(this.isEmpty(this.clips)||!t.graph)return;const s=E(t.canvas,c=>c.attrs.id===n);if(!s){console.warn("[Sa warn]: can not paste in undefined parent.");return}const i=this.clips.elements.map(c=>{const d=new _($(j({},c),{parent:s}));return(r==null?void 0:r.nodeProps)&&V(d.attrs,r.nodeProps(c)),d}),o=i.map(c=>Y(c)),l=n?t.graph.getCellById(s.attrs.id):void 0;if(l)for(const c of o)c.setParent(l),l.addChild(c);return t.addChildren(i,n),t.graph.addNodes(o),i}}function rt(e){return Reflect.has(e,"id")}class it{constructor(t){b(this,"type");b(this,"canvas");b(this,"history");b(this,"clipboard");b(this,"selected",[]);b(this,"graph");b(this,"nextId");this.type="PcForm",this.history=new Qe,this.clipboard=new st,this.nextId="1",this.canvas=new _({parent:void 0,children:[],attrs:t.attrs})}setCanvas(t){this.canvas=t,this.selected=[t],this.nextId=Ze(t)}setGraph(t){this.graph=t}getNextId(){const t=this.nextId;return this.nextId=String(Number(t)+1),t}addChild(t,n){var i;const r=(i=typeof n=="string"?U(this.canvas.children,o=>o.attrs.id===n):n)!=null?i:this.canvas;q(this,t);const s=new L({type:I.Add,time:new Date,data:[{next:j({},A(t))}]});return this.addRecord(s),this.setSelected(t),r}addChildren(t,n){var i;const r=(i=typeof n=="string"?U(this.canvas.children,o=>o.attrs.id===n):n)!=null?i:this.canvas;for(const o of t)q(this,o);const s=new L({type:I.Add,time:new Date,data:t.map(o=>({next:j({},A(o))}))});return this.addRecord(s),this.setSelected(t),r}setSelected(t){if(!!this.graph){if(!arguments.length||Array.isArray(t)&&!t.length)return this.selected=[this.canvas],this.canvas;if(!!this.canvas.children){if(typeof t=="string"){const n=E(this.canvas,r=>r.attrs.id===t);return n&&(this.selected=[n],T(t,this.graph)),n}if(Array.isArray(t)){const n=[];for(const r of t)if(typeof r=="string"){const s=E(this.canvas,i=>i.attrs.id===r);s&&n.push(s)}else n.push(r);return T(n.map(r=>r.attrs.id),this.graph),this.selected=n,n}if(typeof t=="object")return this.selected=[t],T(t.attrs.id,this.graph),t}}}updateElemData(t,n,r=!0){if(!t)return;const s=typeof t=="string"?E(this.canvas,i=>i.attrs.id===t):t;if(!!s){if(r){const i=new L({type:I.Attr,time:new Date,data:[{id:s.attrs.id,prev:A(ie(s.attrs,Object.keys(n))),next:A(n)}]});this.addRecord(i)}return Q(this,s.attrs.id,n),V(s.attrs,n),s}}updateElemsData(t){const n=t.map(s=>({el:rt(s)?E(this.canvas,i=>i.attrs.id===s.id):s.element,data:s.data})),r=new L({type:I.Attr,time:new Date,data:n.map(s=>({id:s.el.attrs.id,prev:A(ie(s.el.attrs,Object.keys(s.data))),next:A(s.data)}))});this.addRecord(r);for(const s of n)this.updateElemData(s.el,s.data,!1);return n.map(s=>s.el)}addRecord(t){console.log("[Sa info]: New record has been added.",t),this.history.index&&this.history.records.length>this.history.index+1&&this.history.records.splice(this.history.index+1),this.history.records.push(t),this.history.index+=1}undo(){var n,r;if(!this.graph)return;const t=this.history.getPrevRecord();if(!t){console.warn("[Sa warn]: None previous record in history.");return}if(console.log("prev record",t,this.history),he(t.data)){for(const s of t.data){const i=E(this.canvas,o=>o.attrs.id===s.id);i&&(V(i.attrs,s.prev),Q(this,s.id,s.prev))}this.setSelected(t.data.map(s=>s.id))}else{for(const s of t.data)t.type===I.Add?me(this,(r=(n=s.next)==null?void 0:n.attrs)==null?void 0:r.id):t.type===I.Delete&&q(this,s.prev);t.type===I.Add?this.setSelected(t.data.map(s=>s.next.attrs.id)):this.setSelected(t.data.map(s=>s.prev.attrs.id))}this.history.index-=1}redo(){var n,r;const t=this.history.getNextRecord();if(!t){console.warn("[Sa warn]: None next record in history.");return}if(he(t.data)){for(const s of t.data){const i=E(this.canvas,o=>o.attrs.id===s.id);i&&(V(i.attrs,s.next),Q(this,s.id,s.next))}this.setSelected(t.data.map(s=>s.id))}else if(Je(t.data)){for(const s of t.data)t.type===I.Add?q(this,s.next):t.type===I.Delete&&me(this,(r=(n=s.prev)==null?void 0:n.attrs)==null?void 0:r.id);t.type===I.Add?this.setSelected(t.data.map(s=>s.next.attrs.id)):this.setSelected(t.data.map(s=>s.prev.attrs.id))}this.history.index+=1}}function Q(e,t,n){var s,i,o,l,c,d;if(!e.graph)return;const r=e.graph.getCellById(t);if(r){const y=z(r);r.setProp({position:{x:(s=n.offsetX)!=null?s:y.position.x,y:(i=n.offsetY)!=null?i:y.position.y},size:{width:(o=n.width)!=null?o:y.size.width,height:(l=n.height)!=null?l:y.size.height}})}else e.graph.size.resize((c=n.width)!=null?c:e.canvas.attrs.width,(d=n.height)!=null?d:e.canvas.attrs.height)}function q(e,t){var r;if(!e.graph||!e.canvas.children||!t)return;const n=e.graph.hasCell(t.attrs.id);if(t.parent){if(!n){const i=Y(t);e.graph.addCell(i);const o=e.graph.getCellById(t.parent.attrs.id);o&&o.addChild(i)}const s=E(e.canvas,i=>{var o;return i.attrs.id===((o=t.parent)==null?void 0:o.attrs.id)});s&&((r=s.children)==null||r.push(t),t.parent=s)}}function me(e,t){if(!e.graph||!e.canvas.children||!t)return;const n=E(e.canvas,r=>r.attrs.id===t);n&&e.canvas.children&&(e.graph.removeCell(n.attrs.id),Ee(e.canvas.children,r=>r.attrs.id===n.attrs.id))}const ot=[{title:"undo",icon:a("i",{class:"iconfont iconchexiao1"},null),click:e=>e.undo()},{title:"redo",icon:a("i",{class:"iconfont iconhuifu1"},null),click:e=>e.redo()}];function at(e,t){return pe(e,t)}function lt(e,t){return pe(e,t)}function ct(e,t){const n=e.getProp("position");e.data.offsetX=n.x,e.data.offsetY=n.y;const r=et(e,_,t);return t.addChild(r),!0}function pe(e,t){const n=t.getNextId(),r=t.canvas;switch(console.log(e),e.data.name){case"Button":return Y({attrs:{id:n,name:"Button",width:80,height:40,type:x.Button,offsetX:0,offsetY:0},parent:r});case"Select":return Y({attrs:{id:n,name:"Select",width:80,height:40,type:x.Select,offsetX:0,offsetY:0},parent:r});case"Container":return Y({attrs:{id:n,name:"Container",width:200,height:100,type:x.Container,offsetX:0,offsetY:0},parent:r});default:console.error("[Sa error]: unexpected drag node",e)}return e}const ut=e=>({groups:[{name:"Normal",collapsable:!0},{name:"Container",collapsable:!0}],getDragNode:t=>at(t,e),getDropNode:t=>lt(t,e),validateNode:t=>ct(t,e),nodes:{Normal:[new O({width:80,height:40,attrs:{rect:{fill:"#31D0C6",stroke:"#4B4A67",strokeWidth:1},text:{text:"Button",fill:"white"}},data:{name:"Button"}}),new O({width:80,height:40,attrs:{rect:{fill:"#31D0C6",stroke:"#4B4A67",strokeWidth:1},text:{text:"Select",fill:"white"}},data:{name:"Select"}})],Container:[new O({width:80,height:40,attrs:{rect:{fill:"#31D0C6",stroke:"#4B4A67",strokeWidth:1},text:{text:"Container",fill:"white"}},data:{name:"Container"}})]}}),dt=()=>{var s;const e=new _({parent:void 0,children:[],attrs:{type:x.Canvas,id:"1",name:"mock pc form",width:800,height:600,offsetX:0,offsetY:0}}),t=new _({parent:e,attrs:{id:"2",type:x.Button,name:"mock button 1",width:80,height:40,offsetX:200,offsetY:100}}),n=new _({parent:e,attrs:{type:x.Button,id:"3",name:"mock button 2",width:80,height:40,offsetX:150,offsetY:200}}),r=new _({parent:e,attrs:{type:x.Container,id:"4",name:"mock container",width:400,height:200,offsetX:50,offsetY:300},children:[]});return(s=e.children)==null||s.push(t,n,r),e};var ht=S({name:"SaPcFormRender",props:{drawer:{required:!0,type:Object}},setup(e){const t=D(null),n=D(null),r=D([]),s=oe(),i=oe();Be(()=>{var l;if(t.value){const c=dt();console.log("create graph",c);const d=new Re({container:t.value,width:c.attrs.width,height:c.attrs.height,snapline:!0,grid:{visible:!0,type:"doubleMesh",args:[{color:"#eee",thickness:1},{color:"#ddd",thickness:1,factor:4}]},selecting:{enabled:!0,multiple:!0,rubberband:!0,movable:!0,showEdgeSelectionBox:!0},resizing:!0,translating:{restrict(u){var P;const f=u.cell,C=u.graph.selection;if(f.isNode()){const m=f.getParent();if(m){const g=m.getBBox();if((P=C==null?void 0:C.cells)==null?void 0:P.length){const h=K(C.cells),R=z(f);return{x:g.x+R.position.x-h.x,y:g.y+R.position.y-h.y,width:g.width-(h.width-R.size.width),height:g.height-(h.height-R.size.height)}}return g}if(C==null?void 0:C.length){const g=K(C.cells),h=z(f);return{x:h.position.x-g.x,y:h.position.y-g.y,width:c.attrs.width-(g.width-h.size.width),height:c.attrs.height-(g.height-h.size.height)}}}return{x:0,y:0,width:c.attrs.width,height:c.attrs.height}}},clipboard:{enabled:!0,useLocalStorage:!0}});je(e.drawer).setGraph(d).setCanvas(c);const y=(l=c.children)==null?void 0:l.map(u=>Y(u));y&&d.addNodes(y),d.enableHistory(),d.on("blank:mousedown",()=>{d.cleanSelection(),n.value.hide()}),d.on("blank:contextmenu",({e:u})=>{d.cleanSelection(),i.value=void 0,s.value=u,n.value.show(u.originalEvent)}),d.on("cell:mousedown",({cell:u})=>{u.toFront({deep:!0}),n.value.hide()}),d.on("cell:contextmenu",({cell:u,e:f})=>{d.isSelected(u)||(d.cleanSelection(),d.select(u)),i.value=u,s.value=f,n.value.show(f.originalEvent)}),d.on("selection:changed",({selected:u})=>{r.value=u,e.drawer.setSelected(u.map(f=>f.data.id)),u.length>1?d.disableSnapline():d.enableSnapline()});let w=[];d.on("node:moved",({cell:u})=>{if(e.drawer.selected.length>1&&e.drawer.selected.some(f=>f.attrs.id===u.id))w.push(u),w.length===e.drawer.selected.length&&(e.drawer.updateElemsData(w.map(f=>{const{x:C,y:P}=f.position();return{id:f.id,data:{offsetX:C,offsetY:P}}})),w=[]);else{const{x:f,y:C}=u.position();e.drawer.updateElemData(u.id,{offsetX:f,offsetY:C}),e.drawer.setSelected(u.id)}}),d.on("node:resized",({cell:u})=>{const{width:f,height:C}=u.size();e.drawer.updateElemData(u.data.id,{width:f,height:C})})}});const o=B(()=>r.value.length?a(Me,null,[a(M("v-contextmenu-item"),{onClick:()=>tt(e.drawer)},{default:()=>[F("copy")]}),a(M("v-contextmenu-item"),{onClick:()=>nt(e.drawer)},{default:()=>[F("cut")]}),a(M("v-contextmenu-item"),{onClick:()=>fe(s.value,i.value,e.drawer)},{default:()=>[F("paste")]}),a(M("v-contextmenu-item"),{type:"danger",icon:a(_e,null,null),onClick:()=>J(e.drawer)},{default:()=>[F("delete")]})]):a(M("v-contextmenu-item"),{onClick:()=>fe(s.value,void 0,e.drawer)},{default:()=>[F("paste")]}));return{workspace:t,contextmenu:n,selectedCells:r,graphContextmenu:o}},render(){return a("div",null,[a("div",{ref:"workspace"},null),a(M("v-contextmenu"),{ref:"contextmenu"},{default:()=>[this.graphContextmenu]})])}}),k;(function(e){e.Input="input",e.Number="number",e.Select="select",e.Dialog="dialog",e.Color="color",e.Cascader="cascader"})(k||(k={}));const v={"widget-id":{label:"id",attr:"id",type:k.Input,disabled:!0},"widget-name":{label:"name",attr:"name",type:k.Input},"widget-width":{label:"width",attr:"width",type:k.Number},"widget-height":{label:"height",attr:"height",type:k.Number},"widget-offsetX":{label:"x",attr:"offsetX",type:k.Number},"widget-offsetY":{label:"y",attr:"offsetY",type:k.Number}},ft={"select-options":{label:"options",attr:"options",type:k.Dialog,dialog:"widget-options",disabled:!0}},mt={[x.Canvas]:{basic:[v["widget-id"],v["widget-name"],v["widget-width"],v["widget-height"]]},[x.Container]:{basic:[v["widget-id"],v["widget-name"],v["widget-width"],v["widget-height"],v["widget-offsetX"],v["widget-offsetY"]]},[x.Button]:{basic:[v["widget-id"],v["widget-name"],v["widget-width"],v["widget-height"],v["widget-offsetX"],v["widget-offsetY"]]},[x.Select]:{basic:[v["widget-id"],v["widget-name"],v["widget-width"],v["widget-height"],v["widget-offsetX"],v["widget-offsetY"],ft["select-options"]]}};function pt(e,t,n){const r=n.selected[0];!r||n.updateElemData(r,{[e]:t})}const gt=()=>({drawer:new it({attrs:{type:x.Canvas,id:"1",name:"Pc Form Demo",width:800,height:600,offsetX:0,offsetY:0}}),header:ot,side:ut,workspace:ht,controller:{plugins:mt,valueChange:pt}}),xt={PcForm:()=>gt()};var vt=S({name:"SaFormLayoutHeader",props:{options:{required:!0,type:Array},drawer:{required:!0,type:Object}},render(){return a("div",{class:"sa-form-header flex justify-start p-1"},[this.options.map(e=>a("span",{class:"header-tool",onClick:t=>e.click(this.drawer,t),title:e.title,style:{width:e.width?`${e.width}px`:"30px",height:"30px"}},[e.icon]))])}}),yt=S({name:"CoFormLayoutSidebar",props:{stencil:{type:Function},drawer:{required:!0,type:Object}},setup(e){const t=D(null),n=B(()=>e.drawer.graph);let r;return ae(()=>n.value,()=>{var s;if(n.value&&!r&&e.stencil){const i=e.stencil(e.drawer);r=new Oe({title:"Components",target:n.value,scaled:!1,animation:!0,search(o,l){const c=o.attrs.text.text;return new RegExp(l,"i").test(c)},placeholder:"Search by shape name",notFoundText:"Not Found",collapsable:!0,stencilGraphWidth:208,stencilGraphHeight:180,groups:i.groups,getDragNode:o=>i.getDragNode(o,e.drawer),getDropNode:o=>i.getDropNode(o,e.drawer),validateNode:o=>i.validateNode(o,e.drawer)}),(s=t.value)==null||s.appendChild(r.container);for(const o of i.groups)r.load(i.nodes[o.name],o.name)}}),{graph:n,refStencil:t}},render(){return a("div",{class:"sa-form-side flex flex-col justify-start p-1 relative w-52"},[a("div",{ref:"refStencil"},null)])}}),wt=S({name:"SaFormControllerDialogLayout",props:{plugin:{required:!0,type:Object},drawer:{required:!0,type:Object}},setup(e){return()=>a("div",null,[e.plugin.dialog])}});function ge(e,t,n,r){r(e.attr,t,n)}function bt(e,t,n){var i,o;const r=t.selected[0];let s;switch(r&&Ct(e.attr,r)&&(s=r==null?void 0:r.attrs[e.attr]),e.type){case k.Input:return a(Ye,{modelValue:s,onInput:l=>ge(e,l,t,n.valueChange),disabled:(i=e.disabled)!=null?i:!1},null);case k.Number:return a(Fe,{controls:!1,modelValue:s,onInput:l=>ge(e,l,t,n.valueChange),disabled:(o=e.disabled)!=null?o:!1},null);case k.Dialog:return a(wt,{drawer:t,plugin:e},null);default:return console.error(`[Sa error]: Unexpected plugin type ${e.type}.`),a("span",{class:"bg-red-700 w-full block text-center"},[e.type])}}function Ct(e,t){return Reflect.has(t.attrs,e)}var St=S({name:"ControllerItem",props:{plugin:{required:!0,type:Object},drawer:{required:!0,type:Object},controller:{required:!0,type:Object}},setup(e){const t=B(()=>bt(e.plugin,e.drawer,e.controller));return()=>a("div",null,[t.value])}});var Nt=S({name:"SaFormLayoutController",props:{drawer:{required:!0,type:Object},controller:{required:!0,type:Object}},setup(e){const t=B(()=>{var r;const n=(r=e.drawer.selected[0])==null?void 0:r.attrs.type;if(n){if(e.controller.plugins[n])return e.controller.plugins[n];console.warn(`[Sa warn]: Plugins not found in type ${x[n]}.`)}});return()=>{var n;return a("div",{class:"controller-container"},[t.value?(n=t.value.basic)==null?void 0:n.map(r=>a("div",{class:"controller-item"},[a("div",{class:"controller-item-label"},[r.label]),a("div",{class:"controller-item-plugin"},[a(St,{plugin:r,drawer:e.drawer,controller:e.controller},null)])])):""])}}}),Dt=S({props:{type:{required:!0,type:String},id:{required:!0,type:String}},setup(e,t){const n=le(xt[e.type]()),r=n.workspace;return()=>a("section",{class:"flex flex-col"},[a("h1",{class:"font-bold text-lg py-4"},[F("Sa Form")]),a("header",null,[a(Xe,null,{default:()=>[a(vt,{options:n.header,drawer:n.drawer,class:"bg-slate-500"},null)]})]),a("main",{class:"mt-1 flex flex-grow"},[a("aside",null,[a(yt,{stencil:n.side,drawer:n.drawer,class:"bg-slate-500 h-full"},null)]),a("main",{class:"flex-grow justify-center bg-slate-500 mx-1 overflow-auto"},[a(r,{drawer:n.drawer},null)]),a("aside",{class:"w-52 bg-slate-500"},[a(Nt,{drawer:n.drawer,controller:n.controller},null)])])])}});const It={class:"w-3/5 mx-auto h-full"},kt=S({setup(e){return(t,n)=>(ze(),$e("div",It,[a(Le(Dt),{id:"1",type:"PcForm",class:"h-1/2"})]))}});const xe=(e,t)=>{var i;const n=t.arg||t.value;if(!n){console.error("\u53C2\u6570\u6709\u8BEF");return}const r=t.value,s=Ve(n)?n.value:(i=t.instance)==null?void 0:i.$refs[n];if(!s){console.error(`\u6CA1\u6709\u627E\u5230 ${n} \u5BF9\u5E94\u7684\u5B9E\u4F8B`);return}if(typeof s.addReference!="function"){console.error(`${n} \u5BF9\u5E94\u7684\u5B9E\u4F8B\u4E0D\u662F VContextmenu`);return}e.$contextmenuKey=n,s.addReference(e,r)},ve=(e,t)=>{var s;const n=e.$contextmenuKey;if(!n)return;const r=(s=t.instance)==null?void 0:s.$refs[n];r==null||r.removeReference(e)},Pt=(e,t)=>{ve(e,t),xe(e,t)},At={mounted:xe,updated:Pt,beforeUnmount:ve},p={contextmenu:"v-contextmenu",contextmenuIcon:"v-contextmenu-icon",contextmenuInner:"v-contextmenu-inner",contextmenuDivider:"v-contextmenu-divider",contextmenuItem:"v-contextmenu-item",contextmenuItemHover:"v-contextmenu-item--hover",contextmenuItemDisabled:"v-contextmenu-item--disabled",contextmenuItemDanger:"v-contextmenu-item--danger",contextmenuGroup:"v-contextmenu-group",contextmenuGroupTitle:"v-contextmenu-group__title",contextmenuGroupMenus:"v-contextmenu-group__menus",contextmenuSubmenu:"v-contextmenu-submenu",contextmenuSubmenuTitle:"v-contextmenu-submenu__title",contextmenuSubmenuMenus:"v-contextmenu-submenu__menus",contextmenuSubmenuMenusTop:"v-contextmenu-submenu__menus--top",contextmenuSubmenuMenusRight:"v-contextmenu-submenu__menus--right",contextmenuSubmenuMenusBottom:"v-contextmenu-submenu__menus--bottom",contextmenuSubmenuMenusLeft:"v-contextmenu-submenu__menus--left",contextmenuSubmenuArrow:"v-contextmenu-submenu__arrow"};function Et(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!ce(e)}const Bt={trigger:["contextmenu"]},ye=S({name:"VContextmenu",props:{modelValue:{type:Boolean,default:!1},autoAjustPlacement:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1},teleport:{type:[String,Object],default:()=>"body"}},emits:["show","hide","update:modelValue"],setup(e,{emit:t}){const n=D(null),r=D(e.modelValue||!1),s=m=>{r.value=m,t("update:modelValue",m)},i=D({top:0,left:0}),o=B(()=>({top:`${i.value.top}px`,left:`${i.value.left}px`})),l=D(null),c=(m,g)=>{var ee,te;const h=m instanceof Event?g:m,R=(h==null?void 0:h.autoAjustPlacement)||e.autoAjustPlacement,N={top:(h==null?void 0:h.top)||0,left:(h==null?void 0:h.left)||0};m instanceof Event&&(m.preventDefault(),N.top=(ee=h==null?void 0:h.top)!=null?ee:m.pageY,N.left=(te=h==null?void 0:h.left)!=null?te:m.pageX),s(!0),ue(()=>{if(R){const G=n.value;if(!G)return;const ne=G.clientWidth,se=G.clientHeight;if(se+N.top>=window.innerHeight+window.scrollY){const X=N.top-se;X>window.scrollY&&(N.top=X)}if(ne+N.left>=window.innerWidth+window.scrollX){const X=N.left-ne;X>window.scrollX&&(N.left=X)}}i.value=N,t("show")})},d=()=>{l.value=null,s(!1),t("hide")},y=le(new Map),w=D(),u=B(()=>w.value&&y.get(w.value)),f=(m,g)=>{const h=(()=>(g==null?void 0:g.trigger)?Array.isArray(g.trigger)?g.trigger:[g.trigger]:Bt.trigger)(),R=N=>{e.disabled||(w.value=m,c(N,{}))};h.forEach(N=>{m.addEventListener(N,R)}),y.set(m,{triggers:h,handler:R})},C=m=>{const g=y.get(m);!g||(g.triggers.forEach(h=>{m.removeEventListener(h,g.handler)}),y.delete(m))},P=m=>{if(!m.target||!n.value||!w.value)return;n.value.contains(m.target)||u.value&&u.value.triggers.includes("click")&&w.value.contains(m.target)||s(!1)};return ae(r,m=>{m?document.addEventListener("click",P):document.removeEventListener("click",P)}),We(()=>{document.removeEventListener("click",P)}),W("visible",r),W("autoAjustPlacement",e.autoAjustPlacement),W("show",c),W("hide",d),{visible:r,style:o,currentReferenceOptions:u,currentOptions:l,contextmenuRef:n,addReference:f,removeReference:C,toggle:s,show:c,hide:d}},methods:{renderContent(){var e,t;return qe(a("div",{class:p.contextmenu,ref:"contextmenuRef",style:this.style},[a("ul",{class:p.contextmenuInner},[(t=(e=this.$slots).default)==null?void 0:t.call(e,{triggerOptions:"currentReferenceOptions",options:"currentOptions"})])]),[[Ge,"visible"]])}},render(){let e;return this.visible?this.teleport?a(He,{to:this.teleport},Et(e=this.renderContent())?e:{default:()=>[e]}):this.renderContent():null}});function Rt(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!ce(e)}const we=S({name:"VContextmenuItem",props:{disabled:{type:Boolean,default:!1},hideOnClick:{type:Boolean,default:!0},icon:{required:!1,type:Object},type:{requred:!1,type:String}},emits:["click","mouseenter","mouseleave"],setup(e,{emit:t}){const n=de("hide"),r=D(!1);return{classes:B(()=>({[p.contextmenuItem]:!0,[p.contextmenuItemDisabled]:e.disabled,[p.contextmenuItemHover]:r.value,[p.contextmenuItemDanger]:e.type==="danger"})),handleClick:c=>{e.disabled||(t("click",c),e.hideOnClick&&(n==null||n()))},handleMouseenter:c=>{e.disabled||(r.value=!0,t("mouseenter",c))},handleMouseleave:c=>{e.disabled||(r.value=!1,t("mouseleave",c))}}},render(){var t,n;const e=this.icon;return a("li",{class:this.classes,onClick:this.handleClick,onMouseenter:this.handleMouseenter,onMouseleave:this.handleMouseleave},[e?a(M("el-icon"),{class:"mr-1 leading-0"},Rt(e)?e:{default:()=>[e]}):a("span",{style:{width:"18px"}},null),(n=(t=this.$slots).default)==null?void 0:n.call(t)])}}),be=S({name:"VContextmenuDivider",render(){return a("li",{class:p.contextmenuDivider},null)}}),jt=S({name:"VContextmenuIcon",props:{name:{type:String,required:!0}},render(){return a("i",{class:[p.contextmenuIcon,`${p.contextmenuIcon}-${this.name}`]},null)}}),Ce=S({name:"VContextmenuSubmenu",props:{title:{type:String,required:!0},disabled:{type:Boolean,default:!1}},emits:["mouseenter","mouseleave"],setup(e,{emit:t}){const n=D(null),r=de("autoAjustPlacement"),s=D(["top","right"]),i=D(!1),o=y=>{e.disabled||(i.value=!0,t("mouseenter",y),ue(()=>{const w=[];if(r){const{target:u}=y,f=u.getBoundingClientRect();if(!n.value)return;const C=n.value.clientWidth,P=n.value.clientHeight;f.right+C>=window.innerWidth?w.push("left"):w.push("right"),f.bottom+P>=window.innerHeight?w.push("bottom"):w.push("top")}s.value=w}))},l=y=>{e.disabled||(i.value=!1,t("mouseleave",y))},c=B(()=>({[p.contextmenuItem]:!0,[p.contextmenuSubmenuTitle]:!0,[p.contextmenuItemHover]:i.value,[p.contextmenuItemDisabled]:e.disabled})),d=B(()=>({[p.contextmenu]:!0,[p.contextmenuSubmenuMenus]:!0,[p.contextmenuSubmenuMenusTop]:s.value.includes("top"),[p.contextmenuSubmenuMenusRight]:s.value.includes("right"),[p.contextmenuSubmenuMenusBottom]:s.value.includes("bottom"),[p.contextmenuSubmenuMenusLeft]:s.value.includes("left")}));return{hover:i,submenuRef:n,titleClasses:c,menusClasses:d,handleMouseenter:o,handleMouseleave:l}},render(){var e,t,n,r;return a("li",{class:p.contextmenuSubmenu,onMouseenter:this.handleMouseenter,onMouseleave:this.handleMouseleave},[a("div",{class:this.titleClasses},[((t=(e=this.$slots).title)==null?void 0:t.call(e))||this.title,a("span",{class:p.contextmenuSubmenuArrow},[a(jt,{name:"right-arrow"},null)])]),this.hover?a("div",{ref:"submenuRef",class:this.menusClasses},[a("ul",{class:p.contextmenuInner},[(r=(n=this.$slots).default)==null?void 0:r.call(n)])]):null])}}),Se=S({name:"VContextmenuGroup",props:{title:{type:String,default:void 0},maxWidth:{type:[Number,String],default:void 0}},setup(e){return{style:B(()=>{if(!!e.maxWidth)return{"max-width":typeof e.maxWidth=="number"?`${e.maxWidth}px`:e.maxWidth,"overflow-x":"auto"}})}},methods:{renderTitle(){var t,n;const e=((n=(t=this.$slots).title)==null?void 0:n.call(t))||this.title;return e?a("div",{class:p.contextmenuGroupTitle},[e]):null}},render(){var e,t;return a("li",{class:p.contextmenuGroup},[this.renderTitle(),a("ul",{style:this.style,class:p.contextmenuGroupMenus},[(t=(e=this.$slots).default)==null?void 0:t.call(e)])])}}),_t=e=>{e.directive("contextmenu",At),e.component(ye.name,ye),e.component(we.name,we),e.component(be.name,be),e.component(Ce.name,Ce),e.component(Se.name,Se)},Mt={install:_t},Z=Ue(kt);Z.use(Mt);Z.use(Ke);Z.mount("#app");
