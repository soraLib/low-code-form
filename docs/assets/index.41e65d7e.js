var le=Object.defineProperty,ae=Object.defineProperties;var ce=Object.getOwnPropertyDescriptors;var z=Object.getOwnPropertySymbols;var de=Object.prototype.hasOwnProperty,me=Object.prototype.propertyIsEnumerable;var $=(e,t,n)=>t in e?le(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,D=(e,t)=>{for(var n in t||(t={}))de.call(t,n)&&$(e,n,t[n]);if(z)for(var n of z(t))me.call(t,n)&&$(e,n,t[n]);return e},N=(e,t)=>ae(e,ce(t));var y=(e,t,n)=>($(e,typeof t!="symbol"?t+"":t,n),n);import{c as s,a as S,R as A,d as k,r as b,s as H,o as he,G as fe,b as _,e as P,f as pe,F as xe,w as T,S as ve,g as K,E as ge,h as we,u as ye,i as be,j as Ce,k as Se,p as R,l as ke,v as Be,T as _e,m as U,n as J,q as Q,t as Pe,x as Ee}from"./vendor.b301486f.js";const Me=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const u of o)if(u.type==="childList")for(const p of u.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&r(p)}).observe(document,{childList:!0,subtree:!0});function n(o){const u={};return o.integrity&&(u.integrity=o.integrity),o.referrerpolicy&&(u.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?u.credentials="include":o.crossorigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function r(o){if(o.ep)return;o.ep=!0;const u=n(o);fetch(o.href,u)}};Me();class F{constructor(t){y(this,"parent");y(this,"children");y(this,"attrs");this.parent=t.parent,this.attrs=t.attrs,t.children&&(this.children=t.children)}}class Fe{constructor(t){y(this,"records",[]);y(this,"index",0);y(this,"max");y(this,"recording");var n,r;this.max=(n=t==null?void 0:t.max)!=null?n:20,this.recording=(r=t==null?void 0:t.recording)!=null?r:!0}}class je{constructor(t){y(this,"type");y(this,"canvas");y(this,"record");y(this,"selected",[]);y(this,"graph");this.type="PcForm",this.record=new Fe,this.canvas=new F({parent:void 0,children:[],attrs:t.attrs})}setGraph(t){this.graph=t}}const Ae=[{title:"undo",icon:s("span",null,[S("undo")]),click:e=>{var t;return console.log("undo",(t=e.graph)==null?void 0:t.undo())}},{title:"redo",icon:s("span",null,[S("redo")]),click:e=>{var t;return console.log("redo",(t=e.graph)==null?void 0:t.redo())}}],Re=[{title:"Button",icon:s("span",null,[S("Button")])},{title:"Container",icon:s("span",null,[S("container")])}];var x;(function(e){e[e.Canvas=0]="Canvas",e[e.Button=1]="Button",e[e.Container=2]="Container"})(x||(x={}));const Oe=()=>{var o;const e=new F({parent:void 0,children:[],attrs:{type:x.Canvas,id:"1",name:"mock pc form",width:800,height:600,offsetX:0,offsetY:0}}),t=new F({parent:e,attrs:{id:"2",type:x.Button,name:"mock button 1",width:80,height:40,offsetX:200,offsetY:100}}),n=new F({parent:e,attrs:{type:x.Button,id:"3",name:"mock button 2",width:80,height:40,offsetX:150,offsetY:200}}),r=new F({parent:e,attrs:{type:x.Container,id:"4",name:"mock container",width:400,height:200,offsetX:50,offsetY:300}});return(o=e.children)==null||o.push(t,n,r),e};function L(e){const t=Object.assign({id:e.attrs.id,x:e.attrs.offsetX,y:e.attrs.offsetY,width:e.attrs.width,height:e.attrs.height},{data:e.attrs});switch(e.attrs.type){case x.Button:return new A(N(D({},t),{attrs:{rect:{fill:"#31D0C6",stroke:"#4B4A67",strokeWidth:1},text:{text:x[e.attrs.type],fill:"white"}}}));case x.Container:return new A(N(D({},t),{attrs:{rect:{fill:"#31D0C6",stroke:"#4B4A67",strokeWidth:1}}}));default:throw new Error(`[Sa error]: unexpected element type ${e.attrs.type}.`)}}function G(e){const t=O(e[0]);let n=t.position.x,r=t.position.x+t.size.width,o=t.position.y,u=t.position.y+t.size.height;return e.forEach(p=>{const i=O(p);i.position.x<n&&(n=i.position.x),r<i.position.x+i.size.width&&(r=i.position.x+i.size.width),i.position.y<o&&(o=i.position.y),u<i.position.y+i.size.height&&(u=i.position.y+i.size.height)}),{x:n,y:o,width:r-n,height:u-o}}function O(e){return{position:e.getProp("position"),size:e.getProp("size")}}function Z(e,t){if(!e)return;let n;if(t)return typeof t=="object"?n=t.toJSON().id:n=t,e.removeNode(n);const r=e.getSelectedCells();if(r.length)for(const o of r)Z(e,o)}function Ie(e){if(!e)return;const t=e.getSelectedCells();e.copy(t,{deep:!0,useLocalStorage:!0})}function ee(e,t,n){if(!n||n.isClipboardEmpty())return;if(t&&t.data.type!==x.Container)return console.error(`[Sa error]: can not paste elements in ${x[t.data.type]}.`);const r=n.paste({useLocalStorage:!0,offset:0}),o=G(r),u=o.x-e.offsetX,p=o.y-e.offsetY;for(const i of r){const a=i.getProp("position");console.log(i,a,u,p),i.setProp("position",{x:a.x-u,y:a.y-p}),i.toFront(),t&&(i.setParent(t),t.addChild(i))}n.cleanSelection(),n.select(r)}function $e(e){if(!e)return;const t=e.getSelectedCells();e.cut(t,{deep:!0,useLocalStorage:!0})}var De=k({name:"SaPcFormRender",props:{drawer:{required:!0,type:Object}},setup(e){const t=b(null),n=b(null),r=b([]),o=H(),u=H();he(()=>{var i;if(t.value){const a=Oe();console.log("create graph",a);const f=new fe({container:t.value,history:!0,width:a.attrs.width,scroller:{pannable:!0},height:a.attrs.height,snapline:!0,grid:{visible:!0,type:"doubleMesh",args:[{color:"#eee",thickness:1},{color:"#ddd",thickness:1,factor:4}]},selecting:{enabled:!0,multiple:!0,rubberband:!0,movable:!0,showEdgeSelectionBox:!0},resizing:!0,translating:{restrict(c){var E;const v=c.cell,g=c.graph.selection;if(v.isNode()){const B=v.getParent();if(B){const l=B.getBBox();if((E=g==null?void 0:g.cells)==null?void 0:E.length){const h=G(g.cells),d=O(v);return{x:l.x+d.position.x-h.x,y:l.y+d.position.y-h.y,width:l.width-(h.width-d.size.width),height:l.height-(h.height-d.size.height)}}return l}if(g==null?void 0:g.length){const l=G(g.cells),h=O(v);return{x:h.position.x-l.x,y:h.position.y-l.y,width:a.attrs.width-(l.width-h.size.width),height:a.attrs.height-(l.height-h.size.height)}}}return{x:0,y:0,width:a.attrs.width,height:a.attrs.height}}},clipboard:{enabled:!0,useLocalStorage:!0}});e.drawer.setGraph(f);const C=(i=a.children)==null?void 0:i.map(c=>L(c));C&&f.addNodes(C),f.on("blank:mousedown",()=>{f.cleanSelection(),n.value.hide()}),f.on("blank:contextmenu",({e:c})=>{f.cleanSelection(),u.value=void 0,o.value=c,n.value.show(c.originalEvent)}),f.on("cell:mousedown",({cell:c})=>{c.toFront({deep:!0}),n.value.hide()}),f.on("cell:contextmenu",({cell:c,e:v})=>{f.isSelected(c)||(f.cleanSelection(),f.select(c)),u.value=c,o.value=v,n.value.show(v.originalEvent)}),f.on("selection:changed",({selected:c})=>{r.value=c})}});const p=_(()=>r.value.length?s(xe,null,[s(P("v-contextmenu-item"),{onClick:()=>Ie(e.drawer.graph)},{default:()=>[S("copy")]}),s(P("v-contextmenu-item"),{onClick:()=>$e(e.drawer.graph)},{default:()=>[S("cut")]}),s(P("v-contextmenu-item"),{onClick:()=>ee(o.value,u.value,e.drawer.graph)},{default:()=>[S("paste")]}),s(P("v-contextmenu-item"),{type:"danger",icon:s(pe,null,null),onClick:()=>Z(e.drawer.graph)},{default:()=>[S("delete")]})]):s(P("v-contextmenu-item"),{onClick:()=>ee(o.value,void 0,e.drawer.graph)},{default:()=>[S("paste")]}));return{workspace:t,contextmenu:n,selectedCells:r,graphContextmenu:p}},render(){return s("div",null,[s("div",{ref:"workspace"},null),s(P("v-contextmenu"),{ref:"contextmenu"},{default:()=>[this.graphContextmenu]})])}});const Ne=()=>({drawer:new je({attrs:{type:x.Canvas,id:"1",name:"Pc Form Demo",width:800,height:600,offsetX:0,offsetY:0}}),header:Ae,side:Re,workspace:De}),Le={PcForm:()=>Ne()};var Ge=k({name:"SaFormLayoutHeader",props:{options:{required:!0,type:Array},drawer:{required:!0,type:Object}},render(){return s("div",{class:"sa-form-header flex justify-start p-1"},[this.options.map(e=>s("span",{class:"header-tool",onClick:t=>e.click(this.drawer,t),title:e.title,style:{width:e.width?`${e.width}px`:"30px",height:"30px"}},[e.icon]))])}}),We=k({name:"CoFormLayoutSidebar",props:{options:{required:!0,type:Array},drawer:{required:!0,type:Object}},setup(e){const t=b(null),n=_(()=>e.drawer.graph);let r;return T(()=>n.value,()=>{var o;if(console.log("GRAPH CHANGE"),n.value&&!r){console.log(n.value,t.value),r=new ve({title:"Components",target:n.value,scaled:!1,animation:!0,search(i,a){const f=i.attrs.text.text;return new RegExp(a,"i").test(f)},placeholder:"Search by shape name",notFoundText:"Not Found",collapsable:!0,stencilGraphWidth:208,stencilGraphHeight:180,groups:[{name:"group1",title:"Group(Collapsable)"},{name:"group2",title:"Group",collapsable:!1}],getDragNode(i){var a;switch(console.log(i),(a=i.attrs)==null?void 0:a.text.text){case"Button":return L({attrs:{id:"4",name:"Button",width:80,height:40,type:x.Button,offsetX:0,offsetY:0},parent:void 0});case"Container":return L({attrs:{id:"5",name:"Container",width:200,height:100,type:x.Container,offsetX:0,offsetY:0},parent:void 0});default:console.error("[Sa error]: unexpected drag node",i)}return i}});const u=new A({width:80,height:40,attrs:{rect:{fill:"#31D0C6",stroke:"#4B4A67",strokeWidth:1},text:{text:"Button",fill:"white"}}}),p=new A({width:80,height:40,attrs:{rect:{fill:"#31D0C6",stroke:"#4B4A67",strokeWidth:1},text:{text:"Container",fill:"white"}}});(o=t.value)==null||o.appendChild(r.container),r.load([u],"group1"),r.load([p],"group2")}}),{graph:n,refStencil:t,stencil:r}},render(){return s("div",{class:"sa-form-side flex flex-col justify-start p-1 relative w-52"},[s("div",{ref:"refStencil"},null)])}}),Xe=k({props:{type:{required:!0,type:String},id:{required:!0,type:String}},setup(e,t){const n=K(Le[e.type]()),r=n.workspace;return()=>s("section",{class:"flex flex-col"},[s("h1",{class:"font-bold text-lg py-4"},[S("Sa Form")]),s("header",null,[s(ge,null,{default:()=>[s(Ge,{options:n.header,drawer:n.drawer,class:"bg-slate-500"},null)]})]),s("main",{class:"mt-1 flex flex-grow"},[s("aside",null,[s(We,{options:n.side,drawer:n.drawer,class:"bg-slate-500 h-full"},null)]),s("main",{class:"flex-grow justify-center bg-slate-500 mx-1 overflow-auto"},[s(r,{drawer:n.drawer},null)]),s("aside",{class:"w-48 bg-slate-500"},[S("properties controller")])])])}});const Ye={class:"w-3/5 mx-auto h-full"},Ve=k({setup(e){return(t,n)=>(be(),we("div",Ye,[s(ye(Xe),{id:"1",type:"PcForm",class:"h-1/2"})]))}});const te=(e,t)=>{var u;const n=t.arg||t.value;if(!n){console.error("\u53C2\u6570\u6709\u8BEF");return}const r=t.value,o=Ce(n)?n.value:(u=t.instance)==null?void 0:u.$refs[n];if(!o){console.error(`\u6CA1\u6709\u627E\u5230 ${n} \u5BF9\u5E94\u7684\u5B9E\u4F8B`);return}if(typeof o.addReference!="function"){console.error(`${n} \u5BF9\u5E94\u7684\u5B9E\u4F8B\u4E0D\u662F VContextmenu`);return}e.$contextmenuKey=n,o.addReference(e,r)},ne=(e,t)=>{var o;const n=e.$contextmenuKey;if(!n)return;const r=(o=t.instance)==null?void 0:o.$refs[n];r==null||r.removeReference(e)},qe=(e,t)=>{ne(e,t),te(e,t)},ze={mounted:te,updated:qe,beforeUnmount:ne},m={contextmenu:"v-contextmenu",contextmenuIcon:"v-contextmenu-icon",contextmenuInner:"v-contextmenu-inner",contextmenuDivider:"v-contextmenu-divider",contextmenuItem:"v-contextmenu-item",contextmenuItemHover:"v-contextmenu-item--hover",contextmenuItemDisabled:"v-contextmenu-item--disabled",contextmenuItemDanger:"v-contextmenu-item--danger",contextmenuGroup:"v-contextmenu-group",contextmenuGroupTitle:"v-contextmenu-group__title",contextmenuGroupMenus:"v-contextmenu-group__menus",contextmenuSubmenu:"v-contextmenu-submenu",contextmenuSubmenuTitle:"v-contextmenu-submenu__title",contextmenuSubmenuMenus:"v-contextmenu-submenu__menus",contextmenuSubmenuMenusTop:"v-contextmenu-submenu__menus--top",contextmenuSubmenuMenusRight:"v-contextmenu-submenu__menus--right",contextmenuSubmenuMenusBottom:"v-contextmenu-submenu__menus--bottom",contextmenuSubmenuMenusLeft:"v-contextmenu-submenu__menus--left",contextmenuSubmenuArrow:"v-contextmenu-submenu__arrow"};function He(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!U(e)}const Te={trigger:["contextmenu"]},oe=k({name:"VContextmenu",props:{modelValue:{type:Boolean,default:!1},autoAjustPlacement:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1},teleport:{type:[String,Object],default:()=>"body"}},emits:["show","hide","update:modelValue"],setup(e,{emit:t}){const n=b(null),r=b(e.modelValue||!1),o=l=>{r.value=l,t("update:modelValue",l)},u=b({top:0,left:0}),p=_(()=>({top:`${u.value.top}px`,left:`${u.value.left}px`})),i=b(null),a=(l,h)=>{var X,Y;const d=l instanceof Event?h:l,j=(d==null?void 0:d.autoAjustPlacement)||e.autoAjustPlacement,w={top:(d==null?void 0:d.top)||0,left:(d==null?void 0:d.left)||0};l instanceof Event&&(l.preventDefault(),w.top=(X=d==null?void 0:d.top)!=null?X:l.pageY,w.left=(Y=d==null?void 0:d.left)!=null?Y:l.pageX),o(!0),J(()=>{if(j){const I=n.value;if(!I)return;const V=I.clientWidth,q=I.clientHeight;if(q+w.top>=window.innerHeight+window.scrollY){const M=w.top-q;M>window.scrollY&&(w.top=M)}if(V+w.left>=window.innerWidth+window.scrollX){const M=w.left-V;M>window.scrollX&&(w.left=M)}}u.value=w,t("show")})},f=()=>{i.value=null,o(!1),t("hide")},C=K(new Map),c=b(),v=_(()=>c.value&&C.get(c.value)),g=(l,h)=>{const d=(()=>(h==null?void 0:h.trigger)?Array.isArray(h.trigger)?h.trigger:[h.trigger]:Te.trigger)(),j=w=>{e.disabled||(c.value=l,a(w,{}))};d.forEach(w=>{l.addEventListener(w,j)}),C.set(l,{triggers:d,handler:j})},E=l=>{const h=C.get(l);!h||(h.triggers.forEach(d=>{l.removeEventListener(d,h.handler)}),C.delete(l))},B=l=>{if(!l.target||!n.value||!c.value)return;n.value.contains(l.target)||v.value&&v.value.triggers.includes("click")&&c.value.contains(l.target)||o(!1)};return T(r,l=>{l?document.addEventListener("click",B):document.removeEventListener("click",B)}),Se(()=>{document.removeEventListener("click",B)}),R("visible",r),R("autoAjustPlacement",e.autoAjustPlacement),R("show",a),R("hide",f),{visible:r,style:p,currentReferenceOptions:v,currentOptions:i,contextmenuRef:n,addReference:g,removeReference:E,toggle:o,show:a,hide:f}},methods:{renderContent(){var e,t;return ke(s("div",{class:m.contextmenu,ref:"contextmenuRef",style:this.style},[s("ul",{class:m.contextmenuInner},[(t=(e=this.$slots).default)==null?void 0:t.call(e,{triggerOptions:"currentReferenceOptions",options:"currentOptions"})])]),[[Be,"visible"]])}},render(){let e;return this.visible?this.teleport?s(_e,{to:this.teleport},He(e=this.renderContent())?e:{default:()=>[e]}):this.renderContent():null}});function Ke(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!U(e)}const re=k({name:"VContextmenuItem",props:{disabled:{type:Boolean,default:!1},hideOnClick:{type:Boolean,default:!0},icon:{required:!1,type:Object},type:{requred:!1,type:String}},emits:["click","mouseenter","mouseleave"],setup(e,{emit:t}){const n=Q("hide"),r=b(!1);return{classes:_(()=>({[m.contextmenuItem]:!0,[m.contextmenuItemDisabled]:e.disabled,[m.contextmenuItemHover]:r.value,[m.contextmenuItemDanger]:e.type==="danger"})),handleClick:a=>{e.disabled||(t("click",a),e.hideOnClick&&(n==null||n()))},handleMouseenter:a=>{e.disabled||(r.value=!0,t("mouseenter",a))},handleMouseleave:a=>{e.disabled||(r.value=!1,t("mouseleave",a))}}},render(){var t,n;const e=this.icon;return s("li",{class:this.classes,onClick:this.handleClick,onMouseenter:this.handleMouseenter,onMouseleave:this.handleMouseleave},[e?s(P("el-icon"),{class:"mr-1 leading-0"},Ke(e)?e:{default:()=>[e]}):s("span",{style:{width:"18px"}},null),(n=(t=this.$slots).default)==null?void 0:n.call(t)])}}),se=k({name:"VContextmenuDivider",render(){return s("li",{class:m.contextmenuDivider},null)}}),Ue=k({name:"VContextmenuIcon",props:{name:{type:String,required:!0}},render(){return s("i",{class:[m.contextmenuIcon,`${m.contextmenuIcon}-${this.name}`]},null)}}),ue=k({name:"VContextmenuSubmenu",props:{title:{type:String,required:!0},disabled:{type:Boolean,default:!1}},emits:["mouseenter","mouseleave"],setup(e,{emit:t}){const n=b(null),r=Q("autoAjustPlacement"),o=b(["top","right"]),u=b(!1),p=C=>{e.disabled||(u.value=!0,t("mouseenter",C),J(()=>{const c=[];if(r){const{target:v}=C,g=v.getBoundingClientRect();if(!n.value)return;const E=n.value.clientWidth,B=n.value.clientHeight;g.right+E>=window.innerWidth?c.push("left"):c.push("right"),g.bottom+B>=window.innerHeight?c.push("bottom"):c.push("top")}o.value=c}))},i=C=>{e.disabled||(u.value=!1,t("mouseleave",C))},a=_(()=>({[m.contextmenuItem]:!0,[m.contextmenuSubmenuTitle]:!0,[m.contextmenuItemHover]:u.value,[m.contextmenuItemDisabled]:e.disabled})),f=_(()=>({[m.contextmenu]:!0,[m.contextmenuSubmenuMenus]:!0,[m.contextmenuSubmenuMenusTop]:o.value.includes("top"),[m.contextmenuSubmenuMenusRight]:o.value.includes("right"),[m.contextmenuSubmenuMenusBottom]:o.value.includes("bottom"),[m.contextmenuSubmenuMenusLeft]:o.value.includes("left")}));return{hover:u,submenuRef:n,titleClasses:a,menusClasses:f,handleMouseenter:p,handleMouseleave:i}},render(){var e,t,n,r;return s("li",{class:m.contextmenuSubmenu,onMouseenter:this.handleMouseenter,onMouseleave:this.handleMouseleave},[s("div",{class:this.titleClasses},[((t=(e=this.$slots).title)==null?void 0:t.call(e))||this.title,s("span",{class:m.contextmenuSubmenuArrow},[s(Ue,{name:"right-arrow"},null)])]),this.hover?s("div",{ref:"submenuRef",class:this.menusClasses},[s("ul",{class:m.contextmenuInner},[(r=(n=this.$slots).default)==null?void 0:r.call(n)])]):null])}}),ie=k({name:"VContextmenuGroup",props:{title:{type:String,default:void 0},maxWidth:{type:[Number,String],default:void 0}},setup(e){return{style:_(()=>{if(!!e.maxWidth)return{"max-width":typeof e.maxWidth=="number"?`${e.maxWidth}px`:e.maxWidth,"overflow-x":"auto"}})}},methods:{renderTitle(){var t,n;const e=((n=(t=this.$slots).title)==null?void 0:n.call(t))||this.title;return e?s("div",{class:m.contextmenuGroupTitle},[e]):null}},render(){var e,t;return s("li",{class:m.contextmenuGroup},[this.renderTitle(),s("ul",{style:this.style,class:m.contextmenuGroupMenus},[(t=(e=this.$slots).default)==null?void 0:t.call(e)])])}}),Je=e=>{e.directive("contextmenu",ze),e.component(oe.name,oe),e.component(re.name,re),e.component(se.name,se),e.component(ue.name,ue),e.component(ie.name,ie)},Qe={install:Je},W=Pe(Ve);W.use(Qe);W.use(Ee);W.mount("#app");
