var Ae=Object.defineProperty,_e=Object.defineProperties;var Re=Object.getOwnPropertyDescriptors;var ae=Object.getOwnPropertySymbols;var je=Object.prototype.hasOwnProperty,Be=Object.prototype.propertyIsEnumerable;var H=(e,t,n)=>t in e?Ae(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,R=(e,t)=>{for(var n in t||(t={}))je.call(t,n)&&H(e,n,t[n]);if(ae)for(var n of ae(t))Be.call(t,n)&&H(e,n,t[n]);return e},X=(e,t)=>_e(e,Re(t));var b=(e,t,n)=>(H(e,typeof t!="symbol"?t+"":t,n),n);import{c as I,f as A,a as U,A as Me,d as w,i as K,r as C,b as c,E as Oe,e as Fe,x as B,l as Le,s as W,p as le,g as Xe,h as Ye,j as T,o as $e,k as E,m as M,F as Ve,n as _,q as We,w as ce,t as ue,u as J,v as de,y as ze,z as qe,B as Ge,C as He,D as Ue,G as he,H as Ke,I as Te,J as Je,K as Qe,L as Ze,M as et,N as z,O as tt,T as nt,P as fe,Q as me,R as st,S as ot}from"./vendor.32631e48.js";const it=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&o(r)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerpolicy&&(i.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?i.credentials="include":s.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}};it();const rt="modulepreload",pe={},at="/sa-form/",lt=function(t,n){return!n||n.length===0?t():Promise.all(n.map(o=>{if(o=`${at}${o}`,o in pe)return;pe[o]=!0;const s=o.endsWith(".css"),i=s?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${o}"]${i}`))return;const r=document.createElement("link");if(r.rel=s?"stylesheet":rt,s||(r.as="script",r.crossOrigin=""),r.href=o,document.head.appendChild(r),s)return new Promise((a,l)=>{r.addEventListener("load",a),r.addEventListener("error",l)})})).then(()=>t())};var D;(function(e){e[e.Add=0]="Add",e[e.Delete=1]="Delete",e[e.Move=2]="Move",e[e.Attr=3]="Attr"})(D||(D={}));function ge(e){return Reflect.has(e[0],"id")}function ct(e){return!Reflect.has(e[0],"id")}function Zt(e,t){return Reflect.has(t.attrs,e)}class j{constructor(t){b(this,"parent");b(this,"children");b(this,"attrs");this.parent=t.parent,this.attrs=I(t.attrs),t.children&&(this.children=t.children)}}class Y{constructor(t){b(this,"type");b(this,"time");b(this,"data");this.time=t.time,this.type=t.type,this.data=t.data}}class ut{constructor(t){b(this,"records",[]);b(this,"index",-1);b(this,"max");b(this,"recording");var n,o;this.max=(n=t==null?void 0:t.max)!=null?n:20,this.recording=(o=t==null?void 0:t.recording)!=null?o:!0}getPrevRecord(){if(!(this.index<0))return this.records[this.index]}getNextRecord(){if(!(this.index>=this.records.length-1))return this.records[this.index+1]}}function Q(e){const t=$(e[0]);let n=t.position.x,o=t.position.x+t.size.width,s=t.position.y,i=t.position.y+t.size.height;return e.forEach(r=>{const a=$(r);a.position.x<n&&(n=a.position.x),o<a.position.x+a.size.width&&(o=a.position.x+a.size.width),a.position.y<s&&(s=a.position.y),i<a.position.y+a.size.height&&(i=a.position.y+a.size.height)}),{x:n,y:s,width:o-n,height:i-s}}function $(e){return e instanceof j?{position:{x:e.attrs.offsetX,y:e.attrs.offsetY},size:{width:e.attrs.width,height:e.attrs.height}}:{position:e.getProp("position"),size:e.getProp("size")}}function dt(e){const t=o(e),n=Number(t);return n?(n+1).toString():"1";function o(s){var u;const i=s.attrs.id;let r="";if((u=s.children)==null?void 0:u.length)for(const d of s.children){const f=o(d),h=Number(r),p=Number(f);h&&p&&(r=Math.max(h,p).toString()),p&&(r=f)}const a=Number(r),l=Number(i);return a&&l?Math.max(a,l).toString():a?r:i}}function ht(e,t,{canvas:n}){var s,i;const o=(s=e.parent)==null?void 0:s.data.id;return new t({attrs:e.data,parent:R({},o&&(i=A(n,r=>r.attrs.id===o))!=null?i:n),children:[]})}function Z(e,t){const n=Array.isArray(e)?e:[e],o=t.getSelectedCells().filter(s=>!n.includes(s.data.id));for(const s of n)t.isSelected(s)||t.select(s);for(const s of o)t.unselect(s)}function ve(e,t){return Reflect.has(t.attrs,e)}var v;(function(e){e[e.Canvas=1]="Canvas",e[e.Button=2]="Button",e[e.Select=3]="Select",e[e.Container=4]="Container"})(v||(v={}));function ee(e,t){var o;if(!(e==null?void 0:e.graph))return;if(t){const s=[];for(const a of t)typeof a=="object"?s.push(a.toJSON().id):s.push(a);const i=s.map(a=>U(e.canvas.children,l=>l.attrs.id===a)),r=new Y({type:D.Delete,time:new Date,data:i.map(a=>({prev:I(a)}))});e.addRecord(r),e.graph.removeCells(s);for(const a of i)((o=a.parent)==null?void 0:o.children)&&Me.remove(a.parent.children,l=>l.attrs.id===a.attrs.id);return i}const n=e.graph.getSelectedCells();n.length&&ee(e,n)}function ft(e){e.clipboard.copy(e,{deep:!0,useLocalStorage:!0})}function mt(e){e.clipboard.cut(e,{deep:!0,useLocalStorage:!0})}function xe(e,t,n){if(n.clipboard.isEmpty(n.clipboard.clips)||!n.graph)return;if(t&&t.data.type!==v.Container)return console.error(`[Sa error]: can not paste elements in ${v[t.data.type]}.`);const o=Q(n.clipboard.clips.elements),s=o.x-e.offsetX,i=o.y-e.offsetY;n.clipboard.paste(n,t==null?void 0:t.data.id,{deep:!0,nodeProps:r=>({id:n.getNextId(),offsetX:r.attrs.offsetX-s,offsetY:r.attrs.offsetY-i})})}var pt=w({name:"SaFormPcSelect",setup(){var o;const e=K("getNode"),t=e==null?void 0:e(),n=C((o=t==null?void 0:t.data.options)!=null?o:[]);return t==null||t.on("change:data",({current:s})=>{var i;n.value=(i=s.options)!=null?i:[]}),()=>c(Oe,{class:"sa-graph-vue-component"},{default:()=>[n.value?n.value.map(s=>c(Fe,{label:s.name,value:s.name},null)):""]})}});function O(e){const t=Object.assign({id:e.attrs.id,x:e.attrs.offsetX,y:e.attrs.offsetY,width:e.attrs.width,height:e.attrs.height},{data:e.attrs});switch(e.attrs.type){case v.Button:return new B.exports.Shape.Rect(X(R({},t),{attrs:{rect:{fill:"#31D0C6",stroke:"#4B4A67",strokeWidth:1},text:{text:v[e.attrs.type],fill:"white"}}}));case v.Select:return new Le.VueShape(X(R({},t),{shape:"vue-shape",component:{render:()=>c(pt,null,null)}}));case v.Container:return new B.exports.Shape.Rect(X(R({},t),{attrs:{rect:{fill:"#31D0C6",stroke:"#4B4A67",strokeWidth:1}}}));default:throw new Error(`[Sa error]: unexpected element type ${e.attrs.type}.`)}}class gt{constructor(){b(this,"clips")}isEmpty(t=this.clips){var n;return!((n=this.clips)==null?void 0:n.elements.length)}copy(t,n){this.clips={elements:I(t.selected),type:"copy"}}cut(t,n){this.clips={elements:I(t.selected),type:"cut"},ee(t)}paste(t,n=t.canvas.attrs.id,o){if(this.isEmpty(this.clips)||!t.graph)return;const s=A(t.canvas,l=>l.attrs.id===n);if(!s){console.warn("[Sa warn]: can not paste in undefined parent.");return}const i=this.clips.elements.map(l=>{const u=new j(X(R({},l),{parent:s}));return(o==null?void 0:o.nodeProps)&&W(u.attrs,o.nodeProps(l)),u}),r=i.map(l=>O(l)),a=n?t.graph.getCellById(s.attrs.id):void 0;if(a)for(const l of r)l.setParent(a),a.addChild(l);return t.addChildren(i,n),t.graph.addNodes(r),i}}function vt(e){return Reflect.has(e,"id")}class xt{constructor(t){b(this,"type");b(this,"canvas");b(this,"history");b(this,"clipboard");b(this,"selected",[]);b(this,"graph");b(this,"nextId");this.type="PcForm",this.history=new ut,this.clipboard=new gt,this.nextId="1",this.canvas=new j({parent:void 0,children:[],attrs:t.attrs})}setCanvas(t){this.canvas=t,this.selected=[t],this.nextId=dt(t)}setGraph(t){this.graph=t}getNextId(){const t=this.nextId;return this.nextId=String(Number(t)+1),t}addChild(t,n){var i;const o=(i=typeof n=="string"?U(this.canvas.children,r=>r.attrs.id===n):n)!=null?i:this.canvas;q(this,t);const s=new Y({type:D.Add,time:new Date,data:[{next:R({},I(t))}]});return this.addRecord(s),this.setSelected(t),o}addChildren(t,n){var i;const o=(i=typeof n=="string"?U(this.canvas.children,r=>r.attrs.id===n):n)!=null?i:this.canvas;for(const r of t)q(this,r);const s=new Y({type:D.Add,time:new Date,data:t.map(r=>({next:R({},I(r))}))});return this.addRecord(s),this.setSelected(t),o}setSelected(t){if(!!this.graph){if(!arguments.length||Array.isArray(t)&&!t.length)return this.selected=[this.canvas],this.canvas;if(!!this.canvas.children){if(typeof t=="string"){const n=A(this.canvas,o=>o.attrs.id===t);return n&&(this.selected=[n],Z(t,this.graph)),n}if(Array.isArray(t)){const n=[];for(const o of t)if(typeof o=="string"){const s=A(this.canvas,i=>i.attrs.id===o);s&&n.push(s)}else n.push(o);return Z(n.map(o=>o.attrs.id),this.graph),this.selected=n,n}if(typeof t=="object")return this.selected=[t],Z(t.attrs.id,this.graph),t}}}updateElemData(t,n,o=!0){if(!t)return;const s=typeof t=="string"?A(this.canvas,i=>i.attrs.id===t):t;if(!!s){if(o){const i=new Y({type:D.Attr,time:new Date,data:[{id:s.attrs.id,prev:I(le(s.attrs,Object.keys(n))),next:I(n)}]});this.addRecord(i)}return te(this,s.attrs.id,n),W(s.attrs,n),s}}updateElemsData(t){const n=t.map(s=>({el:vt(s)?A(this.canvas,i=>i.attrs.id===s.id):s.element,data:s.data})),o=new Y({type:D.Attr,time:new Date,data:n.map(s=>({id:s.el.attrs.id,prev:I(le(s.el.attrs,Object.keys(s.data))),next:I(s.data)}))});this.addRecord(o);for(const s of n)this.updateElemData(s.el,s.data,!1);return n.map(s=>s.el)}addRecord(t){console.log("[Sa info]: New record has been added.",t),this.history.index&&this.history.records.length>this.history.index+1&&this.history.records.splice(this.history.index+1),this.history.records.push(t),this.history.index+=1}undo(){var n,o;if(!this.graph)return;const t=this.history.getPrevRecord();if(!t){console.warn("[Sa warn]: None previous record in history.");return}if(ge(t.data)){for(const s of t.data){const i=A(this.canvas,r=>r.attrs.id===s.id);i&&(W(i.attrs,s.prev),te(this,s.id,s.prev))}this.setSelected(t.data.map(s=>s.id))}else{for(const s of t.data)t.type===D.Add?ye(this,(o=(n=s.next)==null?void 0:n.attrs)==null?void 0:o.id):t.type===D.Delete&&q(this,s.prev);t.type===D.Add?this.setSelected(t.data.map(s=>s.next.attrs.id)):this.setSelected(t.data.map(s=>s.prev.attrs.id))}this.history.index-=1}redo(){var n,o;const t=this.history.getNextRecord();if(!t){console.warn("[Sa warn]: None next record in history.");return}if(ge(t.data)){for(const s of t.data){const i=A(this.canvas,r=>r.attrs.id===s.id);i&&(W(i.attrs,s.next),te(this,s.id,s.next))}this.setSelected(t.data.map(s=>s.id))}else if(ct(t.data)){for(const s of t.data)t.type===D.Add?q(this,s.next):t.type===D.Delete&&ye(this,(o=(n=s.prev)==null?void 0:n.attrs)==null?void 0:o.id);t.type===D.Add?this.setSelected(t.data.map(s=>s.next.attrs.id)):this.setSelected(t.data.map(s=>s.prev.attrs.id))}this.history.index+=1}}function te(e,t,n){var s,i,r,a,l,u;if(!e.graph)return;const o=e.graph.getCellById(t);if(o){const d=$(o);o.setProp({position:{x:(s=n.offsetX)!=null?s:d.position.x,y:(i=n.offsetY)!=null?i:d.position.y},size:{width:(r=n.width)!=null?r:d.size.width,height:(a=n.height)!=null?a:d.size.height}}),o.updateData(n)}else e.graph.size.resize((l=n.width)!=null?l:e.canvas.attrs.width,(u=n.height)!=null?u:e.canvas.attrs.height)}function q(e,t){var o;if(!e.graph||!e.canvas.children||!t)return;const n=e.graph.hasCell(t.attrs.id);if(t.parent){if(!n){const i=O(t);e.graph.addCell(i);const r=e.graph.getCellById(t.parent.attrs.id);r&&r.addChild(i)}const s=A(e.canvas,i=>{var r;return i.attrs.id===((r=t.parent)==null?void 0:r.attrs.id)});s&&((o=s.children)==null||o.push(t),t.parent=s)}}function ye(e,t){if(!e.graph||!e.canvas.children||!t)return;const n=A(e.canvas,o=>o.attrs.id===t);n&&e.canvas.children&&(e.graph.removeCell(n.attrs.id),Xe(e.canvas.children,o=>o.attrs.id===n.attrs.id))}const yt=[{title:"undo",icon:c("i",{class:"iconfont iconchexiao1"},null),click:e=>e.undo()},{title:"redo",icon:c("i",{class:"iconfont iconhuifu1"},null),click:e=>e.redo()}];function bt(e,t){return be(e,t)}function wt(e,t){return be(e,t)}function Ct(e,t){const n=e.getProp("position");return e.data.offsetX=n.x,e.data.offsetY=n.y,setTimeout(()=>{var s;const o=ht(e,j,t);t.addChild(o,(s=e.parent)==null?void 0:s.id)},0),!0}function be(e,t){const n=t.getNextId(),o=t.canvas;switch(e.data.name){case"Button":return O({attrs:{id:n,name:"Button",width:80,height:40,type:v.Button,offsetX:0,offsetY:0},parent:o});case"Select":return O({attrs:{id:n,name:"Select",width:80,height:40,type:v.Select,offsetX:0,offsetY:0,options:[{name:"default"}]},parent:o});case"Container":return O({attrs:{id:n,name:"Container",width:200,height:100,type:v.Container,offsetX:0,offsetY:0},parent:o});default:console.error("[Sa error]: unexpected drag node",e)}return e}const St=e=>({groups:[{name:"Normal",collapsable:!0},{name:"Container",collapsable:!0}],getDragNode:t=>bt(t,e),getDropNode:t=>wt(t,e),validateNode:t=>Ct(t,e),nodes:{Normal:[new B.exports.Shape.Rect({width:80,height:40,attrs:{rect:{fill:"#31D0C6",stroke:"#4B4A67",strokeWidth:1},text:{text:"Button",fill:"white"}},data:{name:"Button"}}),new B.exports.Shape.Rect({width:80,height:40,attrs:{rect:{fill:"#31D0C6",stroke:"#4B4A67",strokeWidth:1},text:{text:"Select",fill:"white"}},data:{name:"Select"}})],Container:[new B.exports.Shape.Rect({width:80,height:40,attrs:{rect:{fill:"#31D0C6",stroke:"#4B4A67",strokeWidth:1},text:{text:"Container",fill:"white"}},data:{name:"Container"}})]}}),Nt=()=>{var s;const e=new j({parent:void 0,children:[],attrs:{type:v.Canvas,id:"1",name:"mock pc form",width:800,height:600,offsetX:0,offsetY:0}}),t=new j({parent:e,attrs:{id:"2",type:v.Button,name:"mock button 1",width:80,height:40,offsetX:200,offsetY:100}}),n=new j({parent:e,attrs:{type:v.Button,id:"3",name:"mock button 2",width:80,height:40,offsetX:150,offsetY:200}}),o=new j({parent:e,attrs:{type:v.Container,id:"4",name:"mock container",width:400,height:200,offsetX:50,offsetY:300},children:[]});return(s=e.children)==null||s.push(t,n,o),e};function Dt(e,t,n){var r;const o=new B.exports.Graph({container:e,width:t.attrs.width,height:t.attrs.height,snapline:!0,grid:{visible:!0,type:"doubleMesh",args:[{color:"#eee",thickness:1},{color:"#ddd",thickness:1,factor:4}]},selecting:{enabled:!0,multiple:!0,rubberband:!0,movable:!0},embedding:{enabled:!0,validate:({parent:a,child:l})=>l.parent===a||a.data.type===v.Container&&!o.hasCell(l)},resizing:!0,translating:{restrict(a){var d;const l=a.cell,u=a.graph.selection;if(l.isNode()){const f=l.getParent();if(f){const h=f.getBBox();if((d=u==null?void 0:u.cells)==null?void 0:d.length){const p=Q(u.cells),k=$(l);return{x:h.x+k.position.x-p.x,y:h.y+k.position.y-p.y,width:h.width-(p.width-k.size.width),height:h.height-(p.height-k.size.height)}}return h}if(u==null?void 0:u.length){const h=Q(u.cells),p=$(l);return{x:p.position.x-h.x,y:p.position.y-h.y,width:t.attrs.width-(h.width-p.size.width),height:t.attrs.height-(h.height-p.size.height)}}}return{x:0,y:0,width:t.attrs.width,height:t.attrs.height}}}});Ye(n).setGraph(o).setCanvas(t);const s=(r=t.children)==null?void 0:r.map(a=>O(a));s&&o.addNodes(s),o.on("blank:mousedown",()=>{o.cleanSelection()}),o.on("blank:contextmenu",({e:a})=>{o.cleanSelection()}),o.on("cell:mousedown",({cell:a})=>{a.toFront({deep:!0})}),o.on("cell:contextmenu",({cell:a,e:l})=>{o.isSelected(a)||(o.cleanSelection(),o.select(a))}),o.on("selection:changed",({selected:a})=>{n.setSelected(a.map(l=>l.data.id)),a.length>1?o.disableSnapline():o.enableSnapline()});let i=[];o.on("node:moved",({cell:a})=>{if(n.selected.length>1&&n.selected.some(l=>l.attrs.id===a.id))i.push(a),i.length===n.selected.length&&(n.updateElemsData(i.map(l=>{const{x:u,y:d}=l.position();return{id:l.id,data:{offsetX:u,offsetY:d}}})),i=[]);else{const{x:l,y:u}=a.position();n.updateElemData(a.id,{offsetX:l,offsetY:u}),n.setSelected(a.id)}}),o.on("node:resized",({cell:a})=>{const{width:l,height:u}=a.size();n.updateElemData(a.data.id,{width:l,height:u})})}var Pt=w({name:"SaPcFormRender",props:{drawer:{required:!0,type:Object}},setup(e){const t=C(null),n=C(null),o=C([]),s=T(),i=T();$e(()=>{if(t.value){const a=Nt();console.log("create graph",a),Dt(t.value,a,e.drawer)}});const r=E(()=>o.value.length?c(Ve,null,[c(M("v-contextmenu-item"),{onClick:()=>ft(e.drawer)},{default:()=>[_("copy")]}),c(M("v-contextmenu-item"),{onClick:()=>mt(e.drawer)},{default:()=>[_("cut")]}),c(M("v-contextmenu-item"),{onClick:()=>xe(s.value,i.value,e.drawer)},{default:()=>[_("paste")]}),c(M("v-contextmenu-item"),{type:"danger",icon:c(We,null,null),onClick:()=>ee(e.drawer)},{default:()=>[_("delete")]})]):c(M("v-contextmenu-item"),{onClick:()=>xe(s.value,void 0,e.drawer)},{default:()=>[_("paste")]}));return{workspace:t,contextmenu:n,selectedCells:o,graphContextmenu:r}},render(){return c("div",null,[c("div",{ref:"workspace"},null),c(M("v-contextmenu"),{ref:"contextmenu"},{default:()=>[this.graphContextmenu]})])}}),P;(function(e){e.Input="input",e.Number="number",e.Select="select",e.Dialog="dialog",e.Color="color",e.Cascader="cascader"})(P||(P={}));const x={"widget-id":{label:"id",attr:"id",type:P.Input,disabled:!0},"widget-name":{label:"name",attr:"name",type:P.Input},"widget-width":{label:"width",attr:"width",type:P.Number},"widget-height":{label:"height",attr:"height",type:P.Number},"widget-offsetX":{label:"x",attr:"offsetX",type:P.Number},"widget-offsetY":{label:"y",attr:"offsetY",type:P.Number}},kt={"select-options":{label:"options",attr:"options",type:P.Dialog,dialog:{component:"widget-options",title:"select-options",filter:e=>e.map(t=>t.name).join(";")},disabled:!0}},It={[v.Canvas]:{basic:[x["widget-id"],x["widget-name"],x["widget-width"],x["widget-height"]]},[v.Container]:{basic:[x["widget-id"],x["widget-name"],x["widget-width"],x["widget-height"],x["widget-offsetX"],x["widget-offsetY"]]},[v.Button]:{basic:[x["widget-id"],x["widget-name"],x["widget-width"],x["widget-height"],x["widget-offsetX"],x["widget-offsetY"]]},[v.Select]:{basic:[x["widget-id"],x["widget-name"],x["widget-width"],x["widget-height"],x["widget-offsetX"],x["widget-offsetY"],kt["select-options"]]}};function Et(e,t,n){const o=n.selected[0];!o||n.updateElemData(o,{[e]:t})}const At={"./PcForm/controller/widget-options/index.tsx":()=>lt(()=>import("./index.028c79c8.js"),["assets/index.028c79c8.js","assets/index.3be83ae9.css","assets/vendor.32631e48.js"])},_t=()=>({drawer:new xt({attrs:{type:v.Canvas,id:"1",name:"Pc Form Demo",width:800,height:600,offsetX:0,offsetY:0}}),header:yt,side:St,workspace:Pt,controller:{plugins:It,valueChange:Et,components:At}}),Rt={PcForm:()=>_t()};var jt=w({name:"SaFormLayoutHeader",props:{options:{required:!0,type:Array},drawer:{required:!0,type:Object}},render(){return c("div",{class:"sa-form-header flex justify-start p-1"},[this.options.map(e=>c("span",{class:"header-tool",onClick:t=>e.click(this.drawer,t),title:e.title,style:{width:e.width?`${e.width}px`:"30px",height:"30px"}},[e.icon]))])}}),Bt=w({name:"CoFormLayoutSidebar",props:{stencil:{type:Function},drawer:{required:!0,type:Object}},setup(e){const t=C(null),n=E(()=>e.drawer.graph);let o;return ce(()=>n.value,()=>{var s;if(n.value&&!o&&e.stencil){const i=e.stencil(e.drawer);o=new B.exports.Addon.Stencil({title:"Components",target:n.value,scaled:!1,animation:!0,search(r,a){const l=r.attrs.text.text;return new RegExp(a,"i").test(l)},placeholder:"Search by shape name",notFoundText:"Not Found",collapsable:!0,stencilGraphWidth:208,stencilGraphHeight:180,groups:i.groups,getDragNode:r=>i.getDragNode(r,e.drawer),getDropNode:r=>i.getDropNode(r,e.drawer),validateNode:r=>i.validateNode(r,e.drawer)}),(s=t.value)==null||s.appendChild(o.container);for(const r of i.groups)o.load(i.nodes[r.name],r.name)}}),{graph:n,refStencil:t}},render(){return c("div",{class:"sa-form-side flex flex-col justify-start p-1 relative w-52"},[c("div",{ref:"refStencil"},null)])}});function we(e,t){const n=e.selected[0];if(!!n&&ve(t.attr,n))return n.attrs[t.attr]}var Mt=w({name:"SaFormControllerDialogLayout",props:{plugin:{required:!0,type:Object},drawer:{required:!0,type:Object},controller:{required:!0,type:Object}},setup(e){var a;const t=C(!1);let n;if(e.plugin.dialog){const l=/\.\/.+\/(.+)\/index.tsx/i;for(const u of Object.keys(e.controller.components)){const d=(a=u.match(l))==null?void 0:a[1];d&&d===e.plugin.dialog.component&&(n=e.controller.components[u])}}const o=T();s();async function s(){if(n){const l=await n();o.value=l.default}}const i=E(()=>o.value?Ge(o.value,{drawer:e.drawer,plugin:e.plugin}):"");function r(){var d,f;const l=(d=i.value)==null?void 0:d.component.exposed;if(!(l==null?void 0:l.update)){console.error(`[Sa error]: Plugin ${(f=e.plugin.dialog)==null?void 0:f.component} doesn't have expose update function.`);return}const{update:u}=l;try{const h=u();He(h,we(e.drawer,e.plugin))||e.drawer.updateElemData(e.drawer.selected[0],{[e.plugin.attr]:I(h)})}catch(h){console.error(h)}t.value=!1}return()=>{var l,u,d;return c("div",{class:"dialog-container"},[((l=e.plugin.dialog)==null?void 0:l.filter)?c(ue,{modelValue:e.plugin.dialog.filter(we(e.drawer,e.plugin)),disabled:!0},null):"",c(J,{onClick:()=>t.value=!0},{default:()=>[_("set")]}),de(c("div",null,[c(qe,{title:(d=(u=e.plugin.dialog)==null?void 0:u.title)!=null?d:e.plugin.label,modelValue:t.value,closeOnClickModal:!1,onClose:()=>t.value=!1,modal:!1},{default:()=>[i.value],footer:()=>c("div",null,[c(J,{type:"default",onClick:()=>t.value=!1},{default:()=>[_("cancel")]}),c(J,{type:"primary",onClick:r},{default:()=>[_("submit")]})])})]),[[ze("dialog-drag")]])])}}});function Ce(e,t,n,o){o(e.attr,t,n)}function Ot(e,t,n){var i,r;const o=t.selected[0];let s;switch(o&&ve(e.attr,o)&&(s=o==null?void 0:o.attrs[e.attr]),e.type){case P.Input:return c(ue,{class:"sa-plugin",modelValue:s,onInput:a=>Ce(e,a,t,n.valueChange),disabled:(i=e.disabled)!=null?i:!1},null);case P.Number:return c(Ue,{class:"sa-plugin",controls:!1,modelValue:s,onInput:a=>Ce(e,a,t,n.valueChange),disabled:(r=e.disabled)!=null?r:!1},null);case P.Dialog:return c(Mt,{class:"sa-plugin",drawer:t,plugin:e,controller:n},null);default:return console.error(`[Sa error]: Unexpected plugin type ${e.type}.`),c("span",{class:"bg-red-700 w-full block text-center"},[e.type])}}var Ft=w({name:"ControllerItem",props:{plugin:{required:!0,type:Object},drawer:{required:!0,type:Object},controller:{required:!0,type:Object}},setup(e){const t=E(()=>Ot(e.plugin,e.drawer,e.controller));return()=>t.value}});var Lt=w({name:"SaFormLayoutController",props:{drawer:{required:!0,type:Object},controller:{required:!0,type:Object}},setup(e){const t=E(()=>{var o;const n=(o=e.drawer.selected[0])==null?void 0:o.attrs.type;if(n){if(e.controller.plugins[n])return e.controller.plugins[n];console.warn(`[Sa warn]: Plugins not found in type ${v[n]}.`)}});return()=>{var n;return c("div",{class:"controller-container"},[t.value?(n=t.value.basic)==null?void 0:n.map(o=>c("div",{class:"controller-item"},[c("div",{class:"controller-item-label"},[o.label]),c("div",{class:"controller-item-plugin"},[c(Ft,{plugin:o,drawer:e.drawer,controller:e.controller},null)])])):""])}}}),Xt=w({props:{type:{required:!0,type:String},id:{required:!0,type:String}},setup(e,t){const n=he(Rt[e.type]()),o=n.workspace;return()=>c("section",{class:"flex flex-col"},[c("h1",{class:"font-bold text-lg py-4"},[_("Sa Form")]),c("header",null,[c(Ke,null,{default:()=>[c(jt,{options:n.header,drawer:n.drawer,class:"bg-slate-500"},null)]})]),c("main",{class:"mt-1 flex flex-grow"},[c("aside",null,[c(Bt,{stencil:n.side,drawer:n.drawer,class:"bg-slate-500 h-full"},null)]),c("main",{class:"flex-grow justify-center bg-slate-500 mx-1 overflow-auto"},[c(o,{drawer:n.drawer},null)]),c("aside",{class:"w-64 bg-slate-500 shrink-0"},[c(Lt,{drawer:n.drawer,controller:n.controller},null)])])])}});const Yt={class:"w-3/5 mx-auto h-full",style:{"min-width":"calc(472px + 0.5rem)"}},$t=w({setup(e){return(t,n)=>(Qe(),Te("div",Yt,[c(Je(Xt),{id:"1",type:"PcForm",class:"h-1/2"})]))}});const Se=(e,t)=>{var i;const n=t.arg||t.value;if(!n){console.error("\u53C2\u6570\u6709\u8BEF");return}const o=t.value,s=Ze(n)?n.value:(i=t.instance)==null?void 0:i.$refs[n];if(!s){console.error(`\u6CA1\u6709\u627E\u5230 ${n} \u5BF9\u5E94\u7684\u5B9E\u4F8B`);return}if(typeof s.addReference!="function"){console.error(`${n} \u5BF9\u5E94\u7684\u5B9E\u4F8B\u4E0D\u662F VContextmenu`);return}e.$contextmenuKey=n,s.addReference(e,o)},Ne=(e,t)=>{var s;const n=e.$contextmenuKey;if(!n)return;const o=(s=t.instance)==null?void 0:s.$refs[n];o==null||o.removeReference(e)},Vt=(e,t)=>{Ne(e,t),Se(e,t)},Wt={mounted:Se,updated:Vt,beforeUnmount:Ne},m={contextmenu:"v-contextmenu",contextmenuIcon:"v-contextmenu-icon",contextmenuInner:"v-contextmenu-inner",contextmenuDivider:"v-contextmenu-divider",contextmenuItem:"v-contextmenu-item",contextmenuItemHover:"v-contextmenu-item--hover",contextmenuItemDisabled:"v-contextmenu-item--disabled",contextmenuItemDanger:"v-contextmenu-item--danger",contextmenuGroup:"v-contextmenu-group",contextmenuGroupTitle:"v-contextmenu-group__title",contextmenuGroupMenus:"v-contextmenu-group__menus",contextmenuSubmenu:"v-contextmenu-submenu",contextmenuSubmenuTitle:"v-contextmenu-submenu__title",contextmenuSubmenuMenus:"v-contextmenu-submenu__menus",contextmenuSubmenuMenusTop:"v-contextmenu-submenu__menus--top",contextmenuSubmenuMenusRight:"v-contextmenu-submenu__menus--right",contextmenuSubmenuMenusBottom:"v-contextmenu-submenu__menus--bottom",contextmenuSubmenuMenusLeft:"v-contextmenu-submenu__menus--left",contextmenuSubmenuArrow:"v-contextmenu-submenu__arrow"};function zt(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!fe(e)}const qt={trigger:["contextmenu"]},De=w({name:"VContextmenu",props:{modelValue:{type:Boolean,default:!1},autoAjustPlacement:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1},teleport:{type:[String,Object],default:()=>"body"}},emits:["show","hide","update:modelValue"],setup(e,{emit:t}){const n=C(null),o=C(e.modelValue||!1),s=g=>{o.value=g,t("update:modelValue",g)},i=C({top:0,left:0}),r=E(()=>({top:`${i.value.top}px`,left:`${i.value.left}px`})),a=C(null),l=(g,S)=>{var se,oe;const y=g instanceof Event?S:g,V=(y==null?void 0:y.autoAjustPlacement)||e.autoAjustPlacement,N={top:(y==null?void 0:y.top)||0,left:(y==null?void 0:y.left)||0};g instanceof Event&&(g.preventDefault(),N.top=(se=y==null?void 0:y.top)!=null?se:g.pageY,N.left=(oe=y==null?void 0:y.left)!=null?oe:g.pageX),s(!0),me(()=>{if(V){const G=n.value;if(!G)return;const ie=G.clientWidth,re=G.clientHeight;if(re+N.top>=window.innerHeight+window.scrollY){const L=N.top-re;L>window.scrollY&&(N.top=L)}if(ie+N.left>=window.innerWidth+window.scrollX){const L=N.left-ie;L>window.scrollX&&(N.left=L)}}i.value=N,t("show")})},u=()=>{a.value=null,s(!1),t("hide")},d=he(new Map),f=C(),h=E(()=>f.value&&d.get(f.value)),p=(g,S)=>{const y=(()=>(S==null?void 0:S.trigger)?Array.isArray(S.trigger)?S.trigger:[S.trigger]:qt.trigger)(),V=N=>{e.disabled||(f.value=g,l(N,{}))};y.forEach(N=>{g.addEventListener(N,V)}),d.set(g,{triggers:y,handler:V})},k=g=>{const S=d.get(g);!S||(S.triggers.forEach(y=>{g.removeEventListener(y,S.handler)}),d.delete(g))},F=g=>{if(!g.target||!n.value||!f.value)return;n.value.contains(g.target)||h.value&&h.value.triggers.includes("click")&&f.value.contains(g.target)||s(!1)};return ce(o,g=>{g?document.addEventListener("click",F):document.removeEventListener("click",F)}),et(()=>{document.removeEventListener("click",F)}),z("visible",o),z("autoAjustPlacement",e.autoAjustPlacement),z("show",l),z("hide",u),{visible:o,style:r,currentReferenceOptions:h,currentOptions:a,contextmenuRef:n,addReference:p,removeReference:k,toggle:s,show:l,hide:u}},methods:{renderContent(){var e,t;return de(c("div",{class:m.contextmenu,ref:"contextmenuRef",style:this.style},[c("ul",{class:m.contextmenuInner},[(t=(e=this.$slots).default)==null?void 0:t.call(e,{triggerOptions:"currentReferenceOptions",options:"currentOptions"})])]),[[tt,"visible"]])}},render(){let e;return this.visible?this.teleport?c(nt,{to:this.teleport},zt(e=this.renderContent())?e:{default:()=>[e]}):this.renderContent():null}});function Gt(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!fe(e)}const Pe=w({name:"VContextmenuItem",props:{disabled:{type:Boolean,default:!1},hideOnClick:{type:Boolean,default:!0},icon:{required:!1,type:Object},type:{requred:!1,type:String}},emits:["click","mouseenter","mouseleave"],setup(e,{emit:t}){const n=K("hide"),o=C(!1);return{classes:E(()=>({[m.contextmenuItem]:!0,[m.contextmenuItemDisabled]:e.disabled,[m.contextmenuItemHover]:o.value,[m.contextmenuItemDanger]:e.type==="danger"})),handleClick:l=>{e.disabled||(t("click",l),e.hideOnClick&&(n==null||n()))},handleMouseenter:l=>{e.disabled||(o.value=!0,t("mouseenter",l))},handleMouseleave:l=>{e.disabled||(o.value=!1,t("mouseleave",l))}}},render(){var t,n;const e=this.icon;return c("li",{class:this.classes,onClick:this.handleClick,onMouseenter:this.handleMouseenter,onMouseleave:this.handleMouseleave},[e?c(st,{class:"mr-1 leading-0"},Gt(e)?e:{default:()=>[e]}):c("span",{style:{width:"18px"}},null),(n=(t=this.$slots).default)==null?void 0:n.call(t)])}}),ke=w({name:"VContextmenuDivider",render(){return c("li",{class:m.contextmenuDivider},null)}}),Ht=w({name:"VContextmenuIcon",props:{name:{type:String,required:!0}},render(){return c("i",{class:[m.contextmenuIcon,`${m.contextmenuIcon}-${this.name}`]},null)}}),Ie=w({name:"VContextmenuSubmenu",props:{title:{type:String,required:!0},disabled:{type:Boolean,default:!1}},emits:["mouseenter","mouseleave"],setup(e,{emit:t}){const n=C(null),o=K("autoAjustPlacement"),s=C(["top","right"]),i=C(!1),r=d=>{e.disabled||(i.value=!0,t("mouseenter",d),me(()=>{const f=[];if(o){const{target:h}=d,p=h.getBoundingClientRect();if(!n.value)return;const k=n.value.clientWidth,F=n.value.clientHeight;p.right+k>=window.innerWidth?f.push("left"):f.push("right"),p.bottom+F>=window.innerHeight?f.push("bottom"):f.push("top")}s.value=f}))},a=d=>{e.disabled||(i.value=!1,t("mouseleave",d))},l=E(()=>({[m.contextmenuItem]:!0,[m.contextmenuSubmenuTitle]:!0,[m.contextmenuItemHover]:i.value,[m.contextmenuItemDisabled]:e.disabled})),u=E(()=>({[m.contextmenu]:!0,[m.contextmenuSubmenuMenus]:!0,[m.contextmenuSubmenuMenusTop]:s.value.includes("top"),[m.contextmenuSubmenuMenusRight]:s.value.includes("right"),[m.contextmenuSubmenuMenusBottom]:s.value.includes("bottom"),[m.contextmenuSubmenuMenusLeft]:s.value.includes("left")}));return{hover:i,submenuRef:n,titleClasses:l,menusClasses:u,handleMouseenter:r,handleMouseleave:a}},render(){var e,t,n,o;return c("li",{class:m.contextmenuSubmenu,onMouseenter:this.handleMouseenter,onMouseleave:this.handleMouseleave},[c("div",{class:this.titleClasses},[((t=(e=this.$slots).title)==null?void 0:t.call(e))||this.title,c("span",{class:m.contextmenuSubmenuArrow},[c(Ht,{name:"right-arrow"},null)])]),this.hover?c("div",{ref:"submenuRef",class:this.menusClasses},[c("ul",{class:m.contextmenuInner},[(o=(n=this.$slots).default)==null?void 0:o.call(n)])]):null])}}),Ee=w({name:"VContextmenuGroup",props:{title:{type:String,default:void 0},maxWidth:{type:[Number,String],default:void 0}},setup(e){return{style:E(()=>{if(!!e.maxWidth)return{"max-width":typeof e.maxWidth=="number"?`${e.maxWidth}px`:e.maxWidth,"overflow-x":"auto"}})}},methods:{renderTitle(){var t,n;const e=((n=(t=this.$slots).title)==null?void 0:n.call(t))||this.title;return e?c("div",{class:m.contextmenuGroupTitle},[e]):null}},render(){var e,t;return c("li",{class:m.contextmenuGroup},[this.renderTitle(),c("ul",{style:this.style,class:m.contextmenuGroupMenus},[(t=(e=this.$slots).default)==null?void 0:t.call(e)])])}}),Ut=e=>{e.directive("contextmenu",Wt),e.component(De.name,De),e.component(Pe.name,Pe),e.component(ke.name,ke),e.component(Ie.name,Ie),e.component(Ee.name,Ee)},Kt={install:Ut};var Tt={install:function(e,t){const n=!!(t==null?void 0:t.containment),o=function(){const i=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,r=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;return{width:i,height:r}},s=function(i){const r=i.getElementsByClassName("el-dialog")[0],a=i.getElementsByClassName("el-dialog__header")[0];a.style.userSelect="none",a.style.cursor="move",a.classList.add("active:bg-gray-100","transition","ease-in","duration-300"),r.offsetX=0,r.offsetY=0;const l=function(f){let h=f.pageX-r.offsetX,p=f.pageY-r.offsetY;if(n){h=Math.max(h,0),p=Math.max(p,0);const k=o();h=Math.min(h,k.width-r.offsetWidth),p=Math.min(p,k.height-r.offsetHeight)}r.style.margin="0px",r.style.left=h+"px",r.style.top=p+"px"},u=function(){removeEventListener("mousemove",l),removeEventListener("mouseup",u)},d=function(f){r.offsetX=f.pageX-r.offsetLeft,r.offsetY=f.pageY-r.offsetTop,addEventListener("mousemove",l),addEventListener("mouseup",u)};a.addEventListener("mousedown",d)};e.directive("dialog-drag",{mounted:s})}};const ne=ot($t);ne.use(Kt);ne.use(Tt,{containment:!0});ne.mount("#app");export{Zt as i};
